try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="61142c20-07aa-4882-a54f-3ce3a7f64bcd",e._sentryDebugIdIdentifier="sentry-dbid-61142c20-07aa-4882-a54f-3ce3a7f64bcd")}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1996],{62380:function(e,t,s){"use strict";var r,a,n,i,l=s(94746);function o(){return(o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)({}).hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e}).apply(null,arguments)}t.Z=function(e){return l.createElement("svg",o({xmlns:"http://www.w3.org/2000/svg",width:109,height:113,fill:"none"},e),r||(r=l.createElement("path",{fill:"url(#supabase_logo_svg__a)",d:"M63.708 110.284c-2.86 3.601-8.658 1.628-8.727-2.97l-1.007-67.251h45.22c8.19 0 12.758 9.46 7.665 15.874z"})),a||(a=l.createElement("path",{fill:"url(#supabase_logo_svg__b)",fillOpacity:.2,d:"M63.708 110.284c-2.86 3.601-8.658 1.628-8.727-2.97l-1.007-67.251h45.22c8.19 0 12.758 9.46 7.665 15.874z"})),n||(n=l.createElement("path",{fill:"#3ECF8E",d:"M45.317 2.071c2.86-3.601 8.657-1.628 8.726 2.97l.442 67.251H9.83c-8.19 0-12.759-9.46-7.665-15.875z"})),i||(i=l.createElement("defs",null,l.createElement("linearGradient",{id:"supabase_logo_svg__a",x1:53.974,x2:94.163,y1:54.974,y2:71.829,gradientUnits:"userSpaceOnUse"},l.createElement("stop",{stopColor:"#249361"}),l.createElement("stop",{offset:1,stopColor:"#3ECF8E"})),l.createElement("linearGradient",{id:"supabase_logo_svg__b",x1:36.156,x2:54.484,y1:30.578,y2:65.081,gradientUnits:"userSpaceOnUse"},l.createElement("stop",null),l.createElement("stop",{offset:1,stopOpacity:0})))))}},89396:function(e,t,s){"use strict";s.d(t,{Y9:function(){return b},fi:function(){return x}});var r=s(57437),a=s(78298),n=s(2265),i=s(59512),l=s(18735),o=s(57346),d=s(94508),c=s(62380),u=s(50126),m=s(36512),p=s(63858);let h=new Set(["lov-view","lov-write","lov-search-replace","lov-line-replace","lov-delete","lov-rename"]),g=(e,t,s,r)=>{var a;if(null==t?void 0:null===(a=t.file_path)||void 0===a?void 0:a.startsWith("mem://")){if("lov-view"===e)return s?"Recalled memory":"Recalling memory";if(["lov-write","lov-search-replace","lov-line-replace"].includes(e))return s?"Updated memory":"Updating memory"}switch(e){case"read_file":case"lov-think":return s?r?"Thought for ".concat(r," second").concat(r>1?"s":""):"Finished thinking":"Thinking";case"lov-view":return s?"Read":"Reading";case"lov-rename":return s?"Renamed":"Renaming";case"lov-delete":return s?"Deleted":"Deleting";case"lov-write":case"lov-search-replace":case"lov-line-replace":return s?"Edited":"Editing";case"lov-add-dependency":return s?"Installed":"Installing";case"lov-remove-dependency":return s?"Uninstalled":"Uninstalling";case"lov-supabase-migration":return s?"Wrote Supabase migration":"Writing Supabase migration";case"lov-search-files":return s?"Searched for":"Searching for";case"lov-list-dir":return s?"Listed":"Listing";case"lov-read-console-logs":case"lov-read-network-requests":return s?"Checked":"Checking";case"scrape_website":case"lov-fetch-website":return s?"Fetched":"Fetching";case"url_screenshot":case"lov-url-screenshot":return s?"Took screenshot of":"Taking screenshot of";case"lov-download-to-repo":return s?"Downloaded file":"Downloading";case"generate_image":return s?"Generated image":"Generating image";case"edit_image":return s?"Edited image":"Editing image";case"web_search":return s?"Searched":"Searching";case"supabase_read_query":case"supabase_analytics_query":case"lov-supabase-read-query":case"lov-supabase-analytics-query":return"Supabase";case"lov-experimental-supabase-read-query":return"Supabase Read";case"lov-experimental-supabase-insert":return"Supabase Insert";case"lov-experimental-supabase-migration":return"Supabase Migration";case"lov-experimental-supabase-analytics-query":return"Supabase Analytics";case"lov-experimental-supabase-configure-auth":return"Updating Auth config";case"read_project_analytics":return s?"Checked analytics":"Checking analytics";default:return e}},x=(e,t,s)=>{try{var r;let a=null==t?void 0:null===(r=t.file_path)||void 0===r?void 0:r.startsWith("mem://");if((["lov-write","lov-search-replace","lov-line-replace"].includes(e)||"lov-view"===e)&&a)return"";switch(e){case"read_file":case"scrape_website":case"url_screenshot":return(null==t?void 0:t.arg0)||"";case"lov-view":case"lov-delete":case"lov-write":case"lov-search-replace":case"lov-line-replace":return(null==t?void 0:t.file_path)||"";case"lov-rename":return(null==t?void 0:t.original_file_path)&&(null==t?void 0:t.new_file_path)?"".concat(t.original_file_path," to ").concat(t.new_file_path):"";case"lov-download-to-repo":return(null==t?void 0:t.target_path)||"";case"generate_image":case"edit_image":return(null==t?void 0:t.prompt)||"";case"web_search":case"lov-search-files":return(null==t?void 0:t.query)||"";case"lov-add-dependency":case"lov-remove-dependency":return(null==t?void 0:t.package)||"";case"lov-list-dir":return(null==t?void 0:t.dir_path)||"";case"lov-read-console-logs":return"console logs";case"lov-read-network-requests":return"network logs";case"lov-fetch-website":case"lov-url-screenshot":return(null==t?void 0:t.url)||"";case"supabase_read_query":case"lov-supabase-read-query":return s?"read from database":"reading from database";case"supabase_analytics_query":case"lov-supabase-analytics-query":return s?"retrieved logs":"retrieving logs";default:return""}}catch(e){return""}},f=(e,t)=>{var s;if("lov-view"===e&&(null==t?void 0:null===(s=t.file_path)||void 0===s?void 0:s.startsWith("mem://")))return"lightbulb_2";switch(e){case"lov-download-to-repo":return"download";case"web_search":return"search";case"generate_image":case"edit_image":return"draw";case"lov-view":return"scan";case"lov-search-replace":case"lov-line-replace":case"lov-write":return"edit_document";case"lov-rename":return"draft";case"lov-delete":return"scan_delete";case"lov-add-dependency":return"extension";case"lov-remove-dependency":return"extension_off";case"lov-think":case"read_file":return"emoji_objects";case"lov-search-files":case"lov-list-dir":return"document_search";case"lov-read-console-logs":case"lov-read-network-requests":return"monitor_heart";case"scrape_website":case"lov-fetch-website":return"tv";case"url_screenshot":case"lov-url-screenshot":return"screenshot_monitor";case"supabase_read_query":return"table";case"supabase_analytics_query":return"history";case"read_project_analytics":return"analytics";default:return"code"}},v=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"light",a="dark"===s?p.A:p.g;switch(e){case"lov-experimental-supabase-read-query":case"lov-experimental-supabase-insert":case"lov-experimental-supabase-migration":case"lov-experimental-supabase-analytics-query":if(!t.query)return null;return(0,r.jsx)(i.Z,{language:"sql",customStyle:{fontSize:"12px"},style:a,children:t.query});default:return null}},b=n.memo(e=>{let{name:t,parsedData:s,done:i=!0,isShimmering:p=!1,duration:b,collapsed:j=!0,onHeightChange:y}=e,_=g(t,s,i,b),w=x(t,s,i),N=f(t,s),{resolvedTheme:E}=(0,a.F)(),C=v(t,s,E),{setCurrentFile:S}=(0,m.r)(),{setActiveView:k}=(0,u.pE)(),[I,A]=(0,n.useState)(!0),P=(0,n.useRef)(null),M=(0,n.useRef)(null),[T,D]=(0,n.useState)(0);(0,n.useEffect)(()=>{j&&A(!0)},[j]);let R=!j&&!!C,L=(0,n.useCallback)(()=>!(!w||w.startsWith("mem://"))&&h.has(t)&&w&&w.includes("."),[w,t]),z=(0,n.useCallback)(e=>{if(e.stopPropagation(),w&&L()){let e=w;if("lov-rename"===t&&w.includes(" to ")){let t=w.split(" to ");e=t[1]||t[0]}S(e),k("dev-mode")}},[w,L,t,S,k]);return(0,n.useEffect)(()=>{if(M.current){let e=new ResizeObserver(()=>{M.current&&(D(M.current.scrollHeight),null==y||y())});return e.observe(M.current),D(M.current.scrollHeight),()=>e.disconnect()}},[y]),(0,r.jsxs)("div",{ref:P,className:"flex flex-col text-muted-foreground",children:[(0,r.jsxs)("div",{className:(0,d.cn)("flex h-6 items-center gap-1.5 whitespace-nowrap text-base font-medium md:text-sm",R&&"cursor-pointer"),onClick:()=>R&&A(!I),children:[R&&(0,r.jsx)(o.Z,{name:"chevron_right",size:"small",className:(0,d.cn)("rotate-90 transition-transform duration-200",I&&"rotate-0")}),(0,r.jsx)("div",{className:"mb-px mr-1 flex shrink-0 items-center",children:t.includes("supabase")?(0,r.jsx)(c.Z,{className:"h-4 w-auto",viewBox:"0 0 109 113"}):(0,r.jsx)(o.Z,{name:N,size:"small",className:"text-muted-foreground"})}),(0,r.jsx)(l.N,{className:"flex-shrink-0 font-normal",isShimmering:p,children:_}),w&&(0,r.jsx)("span",{className:(0,d.cn)("relative w-fit max-w-xs truncate rounded-md bg-secondary px-2 py-0 text-start text-xs font-normal text-muted-foreground",L()&&"cursor-pointer transition-colors hover:bg-secondary/80"),"aria-label":w,title:w,onClick:z,children:(0,r.jsx)(l.N,{isShimmering:p,style:{animationDelay:"1.95s",animationTimingFunction:"ease-out"},className:"truncate",children:w})})]}),(0,r.jsx)("div",{ref:M,className:"overflow-hidden",style:{height:I?0:T,opacity:I?0:1},children:C})]})});b.displayName="ToolUseCard"},50618:function(e,t,s){"use strict";var r=s(57437),a=s(62869),n=s(57346),i=s(81103),l=s(94508);t.Z=e=>{let{onClick:t,isBookmarked:s,className:o}=e;return(0,r.jsxs)(i.u,{children:[(0,r.jsx)(i.aJ,{asChild:!0,children:(0,r.jsx)(a.z,{variant:"ghost",size:"icon",className:(0,l.cn)("group/bookmark h-auto w-auto shrink-0 hover:bg-transparent",o),onClick:t,children:(0,r.jsx)(n.Z,{name:s?"bookmark_fill":"bookmark",size:"small",className:(0,l.cn)("text-muted-foreground transition-colors duration-150 ease-in-out group-hover/bookmark:opacity-75",s?"text-affirmative-primary":"")})})}),(0,r.jsx)(i._v,{children:s?"Remove bookmark from history":"Bookmark in history"})]})}},18252:function(e,t,s){"use strict";s.d(t,{z:function(){return so},Y:function(){return sd}});var r=s(57437),a=s(2265),n=s(21288),i=s(94508),l=s(74746),o=s(82176),d=s(10531),c=s(72116),u=s(1188),m=s(78298),p=s(40236),h=s(59512),g=s(62809),x=s(57346),f=s(63858),v=s(55214),b=s.n(v);let j=(0,a.memo)(e=>{let{children:t,className:s,components:a}=e;return(0,r.jsx)("div",{className:s,children:(0,r.jsx)(p.UG,{components:a,children:t})})});j.displayName="MemoizedReactMarkdown";let y=e=>{let{match:t,codeContent:s,prismTheme:n}=e,[i,l]=(0,a.useState)(!1),o=async()=>{await navigator.clipboard.writeText(String(s)),l(!0),setTimeout(()=>l(!1),2e3)};return(0,r.jsxs)("div",{className:"relative my-2 rounded-md bg-muted",children:[(0,r.jsx)("button",{className:"absolute right-2 top-2 rounded-md bg-secondary p-1 transition-colors hover:bg-muted-hover",onClick:o,children:(0,r.jsx)(x.Z,{name:i?"check":"content_copy",className:"h-4 w-4 text-primary transition-all duration-300"})}),(0,r.jsx)("div",{className:"max-w-full overflow-x-auto font-mono",children:(0,r.jsx)(h.Z,{children:String(s).replace(/\n$/,""),style:n,language:t[1],wrapLongLines:!0,PreTag:"div",customStyle:{padding:"1em",margin:0}})})]})},_=(0,a.memo)(e=>{let{children:t,displayCursor:s,persisted:n}=e,l=!(0,a.useRef)(n).current,o=(0,g.C)(t),{resolvedTheme:d}=(0,m.F)(),c=(0,a.useMemo)(()=>"dark"===d?f.A:f.g,[d]),p=(0,a.useMemo)(()=>({code(e){let{node:t,className:s,children:a}=e,n=/language-(\w+)/.exec(s||"");return n?(0,r.jsx)(y,{match:n,codeContent:a,prismTheme:c}):(0,r.jsx)("span",{className:"mx-px mb-1 inline-block -translate-y-px rounded-md bg-secondary px-1.5 py-1 font-mono text-[13.5px] leading-[13.5px]",children:a})}}),[c]);return(0,r.jsxs)(u.E.div,{initial:{opacity:l?0:1},animate:{opacity:1},transition:{duration:1,ease:"easeOut"},className:"relative max-w-full",children:[l?(0,r.jsx)(j,{className:(0,i.cn)("prose prose-zinc prose-markdown-mobile absolute inset-x-0 top-0 max-w-full dark:prose-invert md:prose-markdown prose-h1:mb-2 prose-h1:text-xl prose-h1:font-medium prose-h2:text-lg prose-h2:font-medium prose-h3:text-base prose-h3:font-medium prose-pre:my-2 prose-pre:whitespace-pre-wrap prose-pre:break-words prose-pre:bg-background prose-ol:my-2 prose-ul:my-2 prose-li:my-0",b().customProse,s&&b().cursor),components:p,children:o}):null,(0,r.jsx)(j,{className:(0,i.cn)("prose prose-zinc prose-markdown-mobile max-w-full dark:prose-invert md:prose-markdown prose-h1:mb-2 prose-h1:text-xl prose-h1:font-medium prose-h2:text-lg prose-h2:font-medium prose-h3:text-base prose-h3:font-medium prose-pre:my-2 prose-pre:whitespace-pre-wrap prose-pre:break-words prose-pre:bg-background prose-ol:my-2 prose-ul:my-2 prose-li:my-0",b().customProse,s&&b().cursor,l&&"pointer-events-none opacity-0"),components:p,children:t})]})});_.displayName="PromptBox";var w=s(62869),N=s(27132),E=s(52089),C=s(65666),S=s(61062),k=s(50126),I=s(90045),A=s(37675),P=s(40878),M=s(91576);let T=e=>{let{actionProps:t}=e,{setActiveMessageId:s,setActiveEditId:n,setConsoleCodeContent:o,setConsoleErrorContent:d,setShowConsole:c,exitConsole:u}=(0,k.pE)(),m=(0,l.aK)(e=>t.messageId?e.messages[t.messageId]:null),p=(0,l.tV)(t.editId),h=(0,k.Sl)(e=>e.consoleContentType),g=(0,k.Sl)(e=>e.activeMessageId),{setCodeViewType:f}=(0,I.VK)(),v=g===t.messageId&&"code"===h,b=(0,a.useMemo)(()=>{var e;return(null==m?void 0:m.type)==="aiMessage"&&(null===(e=m.errors)||void 0===e?void 0:e.filter(e=>!e.dont_show))||[]},[m]),j=(0,N.Z)("md"),{setView:y}=(0,P.zp)(),_=(0,a.useCallback)(()=>{var e;let r=!!(null==p?void 0:null===(e=p.diff)||void 0===e?void 0:e.length);v?u():(j&&y(P.$.PREVIEW),o(t.code),c("code"),d(b),s(t.messageId),n(null==p?void 0:p.id),f(r?I.es.DIFF:I.es.RAW))},[v,u,s,o,d,c,f,n,p,t.messageId,t.code,m]);return(0,r.jsxs)(w.z,{size:"sm",className:(0,i.cn)("h-6 gap-1 px-1.5 py-0.5 text-sm font-normal transition-all duration-150 ease-in-out hover:bg-muted-hover md:h-5 md:text-xs",v&&"bg-affirmative ring-1 ring-affirmative-primary hover:bg-accent/80"),variant:"ghost",onClick:_,children:[(0,r.jsx)(x.Z,{name:"code",size:"small"}),(0,r.jsx)("span",{children:"Code"})]})};var D=s(81103),R=s(49284),L=s(99376),z=s(46214),O=s(26237),F=s(2925),Z=s(79396),U=s(68640),H=s(77113);let V=e=>{let{editId:t,commitSha:s}=e,n=(0,Z.I)(),i=(0,H.iZ)(e=>{var t;return null===(t=e.project)||void 0===t?void 0:t.latest_commit_sha}),o=(0,F.u)(e=>e.setCurrentPage),d=(0,F.u)(e=>e.currentPage),{project_id:c}=(0,L.useParams)(),u=(0,l.tV)(t),m=(0,O.C)(),p=(0,U.Y)({editId:null==u?void 0:u.id,commitSha:null==u?void 0:u.commit_sha}),{isDisabled:h,disabledReason:g}=(0,a.useMemo)(()=>p?{isDisabled:!0,disabledReason:"Cannot restore to an active edit"}:s?n.isPending?{isDisabled:!0,disabledReason:"Restore is in progress"}:m?{isDisabled:!0,disabledReason:(0,r.jsx)("p",{className:"max-w-sm",children:"Cannot revert while there is an active operation in progress (e.g. chat or revert). Please wait for the operation to complete."})}:{isDisabled:m||n.isPending||!s||p,disabledReason:"Disabled"}:{isDisabled:!0,disabledReason:"Not a valid restore target"},[m,n.isPending,s,p]),x=s===i,f=(0,a.useCallback)(e=>{let{eventName:r}=e;t&&(u&&u.pages&&u.pages.length>0&&!u.pages.find(e=>e.name===d)&&o("index"),z.ZP.capture(r,{edit_id:t,commit_sha:s,disabled:h,disabled_reason:g,is_latest_commit:x,is_active_edit:p,project_id:c}),n.mutateAsync({edit:{id:t}}))},[s,d,g,u,t,h,p,c,n,o]);return{onRevert:t?f:void 0,isLatestCommit:x,isDisabled:h,isPending:n.isPending,disabledReason:g}},W=e=>{let{actionProps:t}=e,{onRevert:s,isDisabled:a,isPending:n,disabledReason:l}=V({editId:t.editId,commitSha:t.commitSha}),o=(0,r.jsxs)(w.z,{size:"sm",className:(0,i.cn)("h-6 gap-1 px-1.5 py-0.5 text-sm font-normal transition-colors duration-150 ease-in-out hover:bg-muted-hover md:h-5 md:text-xs"),variant:"ghost",onClick:()=>{s&&s({eventName:R.SL.CODE_CARD.RESTORE_CLICKED})},disabled:a||n,children:[(0,r.jsx)(x.Z,{name:"restart_alt",size:"small",className:n?"animate-spin-reverse":""}),(0,r.jsx)("span",{children:"Restore"})]});return a&&l?(0,r.jsxs)(D.u,{children:[(0,r.jsx)(D.aJ,{asChild:!0,children:(0,r.jsx)("span",{className:"flex items-center rounded",tabIndex:0,children:o})}),(0,r.jsx)(D._v,{children:(0,r.jsx)("p",{children:l})})]}):o},K=(0,a.memo)(e=>{let{children:t,...s}=e;return(0,r.jsx)(w.z,{size:"sm",variant:"ghost",className:"h-5 gap-1 px-1.5 py-0.5 text-xs font-normal transition-colors duration-150 ease-in-out hover:bg-muted-hover",...s,children:t})});K.displayName="CodeCardActionButton";let q=(0,a.memo)(e=>{let{children:t,className:s}=e;return(0,r.jsx)("div",{className:(0,i.cn)("absolute -right-2 bottom-0 translate-y-1/2",s),children:(0,r.jsx)("div",{className:"flex items-center gap-1 rounded-lg border border-muted-border bg-muted p-0.5",children:t})})});q.displayName="BaseCodeCardActions";let G=(0,a.memo)(e=>(0,r.jsxs)(q,{children:[(0,r.jsx)(W,{actionProps:e}),(0,r.jsx)(T,{actionProps:e})]}));G.displayName="CodeCardActions";let B=e=>"parts"in e&&"done"in e,Y={[S.N.CODE_DIFF]:"I couldn't apply your changes because the edit strategy I chose failed.",[S.N.FILE_EDITED_WITHOUT_PERMISSION]:"I couldn't apply your changes because I tried to edit a file that I don't have permission to edit.",[S.N.EXCLUDED_FILE_EDITED]:"I couldn't apply your changes because it resulted in unwanted changes",[S.N.NO_CODE_CHANGE]:"I couldn't apply your changes because the code changes I suggested were the same as the previous code."},J=e=>{var t,s;let{errors:n,messageParts:l,edit:o,projectId:d}=e,{setActiveMessageId:c,setActiveEditId:m,exitConsole:p,setShowConsole:h,setConsoleErrorContent:g,setConsoleCodeContent:f}=(0,k.pE)(),{setCodeViewType:v}=(0,I.VK)(),b=(0,k.Sl)(e=>e.activeMessageId),j=(0,k.Sl)(e=>e.consoleContentType),y=(0,N.Z)("md"),{setView:_}=(0,P.zp)(),C=(0,E.qV)({projectId:d,errorIds:(null==n?void 0:n.map(e=>e.id))||[],setErrors:e=>{}}),S=null==n?void 0:null===(t=n[0])||void 0===t?void 0:t.type,T=(0,a.useMemo)(()=>{let e=Y[S];return e?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{children:e}),(0,r.jsx)("p",{children:"Please rephrase your request or provide more details."})]}):null},[S]),{onClick:D,isPending:R}=(0,M.hw)({projectId:d,errors:n}),L=n[0].message_id||void 0,z="error"===j&&L===b,O=(0,a.useCallback)(()=>{if(z)p();else{var e;let t=null==l?void 0:l.parts.find(B),s=!!(null==o?void 0:null===(e=o.diff)||void 0===e?void 0:e.length);c(L),m(null==o?void 0:o.id),g(n),h("error"),f(t),v(s?I.es.DIFF:I.es.RAW),y&&_(P.$.PREVIEW)}},[z,null==o?void 0:null===(s=o.diff)||void 0===s?void 0:s.length,null==o?void 0:o.id,n,p,y,L,null==l?void 0:l.parts,m,c,v,f,g,h,_]),F=(0,A.bk)(e=>e.isSendChatMessageMutationPending),Z=R||F||0===n.length;return n&&C?(0,r.jsxs)("div",{className:"mt-4 flex flex-col gap-4 pb-4",children:[(0,r.jsxs)(u.E.div,{className:"relative flex w-5/6 max-w-xs pr-9",initial:{opacity:0},animate:{opacity:1},transition:{ease:"easeOut",duration:.5},children:[(0,r.jsx)(q,{className:"pr-9",children:(0,r.jsxs)(K,{onClick:D,loading:R,disabled:Z,children:[!R&&(0,r.jsx)(x.Z,{name:"bolt",size:"small"}),(0,r.jsx)("span",{children:"Try to fix"})]})}),(0,r.jsx)("div",{className:"w-full",children:(0,r.jsxs)(w.z,{onClick:O,variant:"outline",className:(0,i.cn)("flex h-auto w-full items-start gap-2 rounded-xl p-3 text-base font-medium shadow-none md:text-sm","border border-warning-primary bg-warning text-warning-foreground","transition-colors duration-150 ease-in-out","hover:border-warning-primary/80 hover:bg-warning/80",{"border-affirmative-primary/50 bg-affirmative text-affirmative-foreground hover:border-affirmative-primary/40 hover:bg-accent/90":z}),children:[(0,r.jsx)("div",{className:"flex h-5 items-center",children:(0,r.jsx)(x.Z,{name:"warning",size:"small"})}),(0,r.jsxs)("div",{className:"flex w-full flex-col gap-0 overflow-hidden text-left",children:[(0,r.jsx)("span",{className:"truncate font-medium",children:"Error"}),(0,r.jsx)("span",{className:(0,i.cn)("truncate text-base font-normal md:text-sm"),children:M.v7[n[0].type]})]}),(0,r.jsx)(x.Z,{name:"chevron_right"})]})})]}),T]}):null},X=e=>{let{errors:t,messageParts:s,edit:a}=e,n=(0,C.D)(),i=null==t?void 0:t.filter(e=>!e.dont_show);return i&&0!==i.length?(0,r.jsx)(J,{edit:a,errors:i,messageParts:s,projectId:n}):null};var $=s(33145),Q=s(27648),ee=s(49360),et=s(26438),es=s(91846),er=s.n(es),ea=s(60256),en=s(72380);let ei=e=>!e||!e.visual_edits_dismissed_at&&!e.visual_edits_temporarily_closed,el=e=>{let{url:t}=e,[s,n]=(0,a.useState)(!0),i=(0,o.dl)(d.P.BetaTesters),{snapshot:{getUserMessageCount:c}}=(0,l.mx)(),{userData:u}=(0,ea.SE)(),m=(0,en.v)(),p=1>=c(),h=(0,a.useMemo)(()=>ei(null==u?void 0:u.tips),[null==u?void 0:u.tips]);return p&&s&&i&&h?(0,r.jsx)("div",{className:"w-full",children:(0,r.jsxs)("div",{className:"rounded-lg bg-muted p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between pb-4",children:[(0,r.jsxs)("span",{className:"flex items-center gap-2 text-base font-medium text-popover-foreground",children:[(0,r.jsx)(x.Z,{name:"my_location"}),(0,r.jsx)("h1",{className:"text-base font-medium",children:"Visual Edits"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{className:"text-base text-muted-foreground hover:underline",onClick:()=>{z.ZP.capture(R.SL.VIDEO_PLAYER.DONT_SHOW_AGAIN_CLICKED),m.mutate({visual_edits_dismissed_at:new Date().toISOString()}),n(!1)},children:"Don't show again"}),(0,r.jsx)("button",{className:"text-muted-foreground",onClick:()=>{z.ZP.capture(R.SL.VIDEO_PLAYER.CLOSE_CLICKED),m.mutate({visual_edits_temporarily_closed:new Date().toISOString()}),n(!1)},children:(0,r.jsx)(x.Z,{name:"close"})})]})]}),(0,r.jsx)("div",{className:"overflow-hidden rounded-lg",children:(0,r.jsx)(er(),{url:t,controls:!0,width:"100%",height:"100%",playbackRate:2.5,onPlay:()=>{z.ZP.capture(R.SL.VIDEO_PLAYER.PLAY_STARTED)}})})]})}):null};var eo=s(14438),ed=s(26110),ec=s(76818),eu=()=>{let[e,t]=(0,a.useState)(!1),[s,n]=(0,a.useState)(""),i=(0,H.iZ)(e=>e.project),{updateProject:l}=(0,H.d2)();(0,a.useEffect)(()=>{(null==i?void 0:i.custom_instructions)&&n(i.custom_instructions)},[i]);let o=async()=>{try{l({custom_instructions:s},{onSuccess:()=>{z.ZP.capture(R.SL.KNOWLEDGE.SAVED),eo.Am.success("Custom instructions updated",{description:"Your custom instructions have been saved successfully."})}}),t(!1)}catch(e){eo.Am.error("Error",{description:"Failed to update custom instructions. Please try again."})}};return(0,r.jsxs)(ed.Vq,{open:e,onOpenChange:t,children:[(0,r.jsx)(ed.hg,{asChild:!0,children:(0,r.jsxs)(w.z,{className:"gap-2 whitespace-nowrap",variant:"outline",size:"sm",onClick:()=>t(!0),children:[(0,r.jsx)(x.Z,{name:"school",className:"text-muted-foreground"}),"Manage knowledge"]})}),(0,r.jsxs)(ed.cZ,{size:"lg",children:[(0,r.jsx)(ed.fK,{children:(0,r.jsx)(ed.$N,{children:"Manage Knowledge"})}),(0,r.jsxs)(ed.Be,{children:["Add custom context and instructions for your project. Lovable will use it in every edit. Use it to:",(0,r.jsxs)("ul",{className:"mt-2 list-disc pl-5",children:[(0,r.jsx)("li",{children:"Define project-specific rules or guidelines"}),(0,r.jsx)("li",{children:"Set coding style preferences (e.g., indentation, naming conventions)"}),(0,r.jsx)("li",{children:"Include external documentation or style guides"})]})]}),(0,r.jsx)(ec.g,{value:s,onChange:e=>n(e.target.value),placeholder:"Enter your custom instructions and context here...",className:"resize-none",rows:16}),(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)(w.z,{onClick:o,children:"Save"})})]})]})},em=s(78079),ep=s(13590),eh=s(49027),eg=s(21770),ex=s(29501),ef=s(91115),ev=s(15681),eb=s(95186),ej=s(64040),ey=s(49131),e_=s(10867);let ew=e=>{let t=e.reduce((e,t)=>(e[t.key]=ef.Z_().min(1,{message:"".concat(t.name," is required")}),e),{});return ef.Ry(t)},eN=e=>e.toLowerCase().split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ").replace(/api/i,"API"),eE=(0,a.memo)(e=>{let{secretFormActions:t,isMostRecentMessage:s}=e,[n,i]=(0,a.useState)(!1),l=(0,C.D)(),{mutate:o}=(0,em.mo)({projectId:l}),d=(0,a.useMemo)(()=>t.map(e=>({key:e.name,name:eN(e.name)})),[t]),c=(0,a.useMemo)(()=>ew(d),[d]),u=(0,ex.cI)({resolver:(0,ep.F)(c),defaultValues:t.reduce((e,t)=>(e[t.name]="",e),{})});(0,a.useEffect)(()=>{n&&u.reset()},[n,u]);let m=(0,eg.D)({mutationFn:async e=>{let t={secrets:Object.entries(e).map(e=>{let[t,s]=e;return{name:t,value:s}})},s=(0,ey.SJ)();await s.post("/projects/".concat(l,"/supabase/secrets"),t)},onSuccess:()=>{eo.Am.success("API Keys added successfully"),i(!1),o({body:{id:(0,e_.Fd)(),message:"I have now added the API keys you asked for."}})},onError:e=>{(0,ej.Eo)(e)}}),p=(0,a.useCallback)(async e=>{await m.mutateAsync(e)},[m]);return(0,r.jsxs)(ed.Vq,{open:n,onOpenChange:i,children:[(0,r.jsx)(ed.hg,{children:(0,r.jsxs)(w.z,{disabled:!s,variant:"outline",size:"sm",className:"flex items-center gap-1 overflow-hidden text-ellipsis whitespace-nowrap",children:[(0,r.jsx)(x.Z,{name:"key",size:"small"}),"Add API Key",1===t.length?"":"s"]})}),(0,r.jsxs)(ed.cZ,{className:"sm:max-w-[425px]",children:[(0,r.jsxs)(ed.fK,{children:[(0,r.jsx)(ed.$N,{asChild:!0,children:(0,r.jsxs)("h1",{className:"text-2xl font-medium",children:["Add API Key",1===t.length?"":"s"]})}),(0,r.jsxs)(eh.Be,{className:"text-muted-foreground",children:["Enter your API Key",1===t.length?"":"s"," to continue. Manage this later from the Supabase menu."," ",(0,r.jsx)(Q.default,{href:"https://docs.lovable.dev/integrations/supabase#storing-secrets-with-supabase",className:"text-primary underline hover:no-underline",target:"_blank",children:"Learn more"})]})]}),(0,r.jsx)(ev.l0,{...u,children:(0,r.jsxs)("form",{onSubmit:u.handleSubmit(p),className:"space-y-4",children:[d.map(e=>(0,r.jsx)(ev.Wi,{control:u.control,name:e.key,render:t=>{let{field:s}=t;return(0,r.jsxs)(ev.xJ,{children:[(0,r.jsx)(ev.lX,{children:e.name}),(0,r.jsx)(ev.NI,{children:(0,r.jsx)(eb.I,{placeholder:"Enter API Key",type:"password",autoComplete:"off",autoSave:"off",...s})}),(0,r.jsx)(ev.zG,{})]})}},e.key)),(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,r.jsx)(eh.GG,{asChild:!0,children:(0,r.jsx)(w.z,{type:"button",disabled:m.isPending,variant:"outline",children:"Cancel"})}),(0,r.jsx)(w.z,{loading:m.isPending,type:"submit",children:"Submit"})]})]})})]})]})});eE.displayName="AddApiKeysButton";let eC=e=>{let t=document.createElement("div");return t.innerHTML=e,(t.textContent||t.innerText||"").replace(/\n\s*\n/g,"\n\n").trim()};function eS(e){let{open:t,onOpenChange:s,onFeedbackSubmit:n,messageId:i,projectId:l,onCancel:o,initialContent:d}=e,[c,u]=(0,a.useState)(""),[m,p]=(0,a.useState)([]);(0,a.useEffect)(()=>{t&&u(d||"")},[t,d]);let h=e=>{p(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])};return(0,r.jsx)(ed.Vq,{open:t,onOpenChange:e=>{!e&&(c.length>0||m.length>0)&&z.ZP.capture("message_feedback:dialog_cancelled",{messageId:i,projectId:l,action:"close",hadContent:c.length>0,hadCategories:m.length>0}),e||(u(""),p([]),null==o||o()),s(e)},children:(0,r.jsx)(ed.cZ,{children:(0,r.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-foreground",children:"Help us improve"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Please tell us why this response wasn't helpful to you."}),(0,r.jsx)("div",{className:"mt-4 grid grid-cols-2 gap-2",children:["Design is off","Unrelated changes made","Functionality is broken","Other"].map(e=>(0,r.jsx)(w.z,{variant:m.includes(e)?"default":"outline",className:"w-full justify-start pl-4 ".concat(m.includes(e)?"border border-primary":""),size:"lg",onClick:()=>h(e),children:e},e))})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-sm text-muted-foreground",children:"Additional Feedback"}),(0,r.jsx)(ec.g,{placeholder:"This was not helpful because ...",value:c,className:"min-h-24 resize-none",onChange:e=>u(e.target.value)})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,r.jsx)(w.z,{onClick:()=>{z.ZP.capture("message_feedback:dialog_cancelled",{messageId:i,projectId:l,action:"cancel",hadContent:c.length>0,hadCategories:m.length>0}),u(""),p([]),s(!1),null==o||o()},size:"sm",variant:"secondary",children:"Cancel"}),(0,r.jsx)(w.z,{onClick:()=>{n({content:c,categories:m}),u(""),p([]),s(!1)},size:"sm",variant:"default",children:"Submit"})]})]})})})}let ek=(0,a.memo)(e=>{let{message:t}=e,s=(0,H.iZ)(e=>{var t;return null===(t=e.project)||void 0===t?void 0:t.id}),n=(0,ey.SJ)(),[i,l]=(0,a.useState)(t.feedbackSentiment||null),[o,d]=(0,a.useState)(!1),[c,u]=(0,a.useState)(!1);(0,a.useEffect)(()=>{l(t.feedbackSentiment||null)},[t.feedbackSentiment]);let m=(0,eg.D)({mutationFn:async e=>{let{sentiment:r,content:a,categories:i}=e;if(!s)throw Error("Project ID is required");let l={sentiment:r};a&&(l.content=a),i&&i.length>0&&(l.category=i.join(", ")),await n.post("/projects/".concat(s,"/messages/").concat(t.id,"/feedback"),l)},onSuccess:()=>{eo.Am.success("Thanks for your feedback!")},onError:e=>{eo.Am.error("Failed to save feedback",{description:(null==e?void 0:e.message)||"Please try again"})}}),p=async()=>{try{let e=eC(t.content);await navigator.clipboard.writeText(e),u(!0),setTimeout(()=>u(!1),2e3),z.ZP.capture("message_copy",{messageId:t.id,projectId:s})}catch(e){(0,ej.Eo)(e)}},h=(0,N.Z)("md");return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"mt-1.5 flex flex-shrink-0 items-center gap-3 pr-1",children:[(0,r.jsx)("button",{onClick:()=>{let e="positive"===i?null:"positive";l(e),e&&(m.mutate({sentiment:e}),z.ZP.capture("message_feedback:thumbs_up"))},className:"flex items-center gap-1 transition-colors focus:outline-none ".concat("positive"===i?"text-white-600 hover:text-white-700":"text-muted-foreground hover:text-foreground"),title:"Helpful",children:(0,r.jsx)(x.Z,{size:h?"default":"small",name:"positive"===i?"thumb_up-fill":"thumb_up"})}),(0,r.jsx)("button",{onClick:()=>{"negative"===i?z.ZP.capture("message_feedback:dialog_opened_for_edit",{messageId:t.id,projectId:s,hadPreviousContent:!!t.feedbackContent}):l("negative"),d(!0)},className:"flex items-center gap-1 transition-colors focus:outline-none ".concat("negative"===i?"text-white-600 hover:text-white-700":"text-muted-foreground hover:text-foreground"),title:"Not helpful",children:(0,r.jsx)(x.Z,{size:h?"default":"small",name:"negative"===i?"thumb_down-fill":"thumb_down"})}),(0,r.jsx)("button",{onClick:p,className:"flex items-center gap-1 text-muted-foreground transition-colors hover:text-foreground focus:outline-none",title:c?"Copied!":"Copy message",children:(0,r.jsx)(x.Z,{size:h?"default":"small",name:c?"check":"content_copy"})})]}),(0,r.jsx)(eS,{open:o,onOpenChange:d,onFeedbackSubmit:e=>{m.mutate({sentiment:"negative",content:e.content,categories:e.categories})},messageId:t.id,projectId:s,onCancel:()=>{t.feedbackContent||l(null)},initialContent:t.feedbackContent})]})});ek.displayName="MessageFeedbackButtons";var eI=s(72384);let eA=e=>{let{messageId:t,runState:s,toolUseId:a}=e,n=(0,C.D)(),{mutateAsync:i,isPending:l}=(0,em.mo)({projectId:n}),o=async()=>{await i({body:{message:"I have reviewed the SQL and it looks good. Please run it.",id:(0,e_.Fd)(),mode:eI.S.INSTANT,run_sql_in_message_with_id:t,prev_session_id:a?t:void 0},projectId:n})};return(0,r.jsx)("div",{children:(0,r.jsx)(w.z,{variant:"default",size:"sm",className:"gap-2 py-2",onClick:o,disabled:void 0!==s&&"not_started"!==s||l,children:"not_started"===s||void 0===s?"Apply changes":"running"===s?"Applying changes...":"failed"===s?"Failed to apply changes":"SQL already executed"})})},eP=e=>e.startsWith("https://supabase.com/dashboard/project/")||e.includes("?settings=supabase")?(0,r.jsx)($.default,{width:16,height:16,src:"/icons/supabase_logo.svg",alt:"Supabase"}):(0,r.jsx)(x.Z,{name:"arrow_outward"});function eM(e){let{linkActions:t}=e;return t&&0!==t.length?(0,r.jsx)(r.Fragment,{children:null==t?void 0:t.map(e=>{let t=e.url.startsWith("/projects/");return(0,r.jsx)(w.z,{asChild:!0,variant:"outline",size:"sm",className:"flex items-center gap-1 overflow-hidden text-ellipsis whitespace-nowrap",children:(0,r.jsxs)(Q.default,{href:e.url,target:t?void 0:"_blank",rel:"noopener noreferrer",children:[eP(e.url),(0,r.jsx)("span",{className:"truncate",children:e.text})]})},e.url)})}):null}function eT(e){let{messagePromptActions:t}=e,s=(0,H.iZ)(e=>e.projectId),a=(0,I.hT)(e=>e.chatMode),{setChatMode:n}=(0,I.VK)(),{isAgentModeDefault:i}=(0,et.v)(),{mutate:l,isPending:o}=(0,em.OU)({projectId:s});return t&&0!==t.length?(0,r.jsx)(r.Fragment,{children:null==t?void 0:t.map(e=>(0,r.jsx)(w.z,{asChild:!0,variant:"outline",size:"sm",disabled:o,onClick:()=>{a===I.jE.CHAT_ONLY&&n(i?I.jE.AGENT:I.jE.DEFAULT),l({body:{id:(0,ee.Z)(),message:e.message}})},className:"flex cursor-pointer items-center gap-1 overflow-hidden text-ellipsis whitespace-nowrap",children:(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)(x.Z,{name:"chat_bubble",size:"small"}),(0,r.jsx)("span",{className:"truncate",children:e.text})]})},e.message))}):null}let eD=e=>{var t,s;let{message:n,messageId:i,lovActions:o,sqlRunState:d,persisted:c}=e,{isMostRecentMessage:m}=(0,l.mx)(),{migrateActions:p,linkActions:h,knowledgeAction:g,messagePromptActions:x,secretFormActions:f}=(0,a.useMemo)(()=>{let e=null==o?void 0:o.filter(e=>"lov_action__migrate"===e.type&&e.done),t=null==o?void 0:o.filter(e=>"lov_action__link"===e.type),s=null==o?void 0:o.filter(e=>"lov_action__message_prompt"===e.type),r=null==o?void 0:o.filter(e=>"lov_action__secret_form"===e.type);return{migrateActions:e,linkActions:t,knowledgeAction:null==o?void 0:o.find(e=>"lov_action__knowledge"===e.type),messagePromptActions:s,secretFormActions:r}},[o]);return(0,r.jsxs)(u.E.div,{className:"flex max-w-full flex-1 flex-col gap-4 overflow-hidden",initial:{opacity:c?1:0},animate:{opacity:1},transition:{ease:"easeOut",duration:1},children:[c&&(0,r.jsx)(el,{url:"https://customer-8etxbtq55jiz5gtf.cloudflarestream.com/0989fc00edc27647d46bd169d87b7200/manifest/video.m3u8"}),(0,r.jsxs)("div",{className:"flex items-start justify-between gap-4 overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex min-w-0 flex-1 flex-wrap items-center gap-2",children:[(null!==(s=null==p?void 0:p.length)&&void 0!==s?s:0)>0&&(0,r.jsx)(eA,{messageId:i,runState:d,toolUseId:null==p?void 0:null===(t=p[0])||void 0===t?void 0:t.toolUseId},"migrate"),(0,r.jsx)(eM,{linkActions:h}),(0,r.jsx)(eT,{messagePromptActions:x}),f&&f.length>0&&(0,r.jsx)(eE,{secretFormActions:f,isMostRecentMessage:m(i)}),g&&(0,r.jsx)(eu,{})]}),c&&(0,r.jsx)(ek,{message:n})]})]})};var eR=s(48614),eL=s(39484);let ez=e=>{let t=(0,k.Sl)(e=>e.consoleContentType),s=(0,k.Sl)(e=>e.activeView),r=(0,k.Sl)(e=>e.activeEditId),a=(0,l.aK)(e=>e.edits),n=r?a[r]:null,i=(0,U.Y)({editId:null==e?void 0:e.id,commitSha:null==e?void 0:e.commit_sha}),o=null==n?void 0:n.revert_target_edit_id,d=(null==n?void 0:n.id)===(null==e?void 0:e.id)||!!o&&o===(null==e?void 0:e.id);return{isActive:d&&"snapshot-preview"===t,isActiveCode:d&&"code"===t,shouldShowCurrentEditHighlight:i&&"error"!==t&&"snapshot-preview"!==t&&"code"!==t&&!!e&&"dev-mode"!==s}};var eO=s(76906);let eF=e=>{var t;let{edit:s,messageId:r,code:n}=e,i=(0,H.iZ)(e=>e.project),{setActiveMessageId:l,setActiveEditId:o,setShowConsole:d,exitConsole:c,setConsolePreviewContent:u,setConsoleCodeContent:m,setConsoleErrorContent:p}=(0,k.pE)(),{setCodeViewType:h}=(0,I.VK)(),g=(0,U.Y)({editId:null==s?void 0:s.id,commitSha:null==s?void 0:s.commit_sha}),{isActive:x,isActiveCode:f}=ez(s),v=(0,a.useMemo)(()=>{if((null==s?void 0:s.commit_sha)&&i)return(0,eO.t)({projectId:null==i?void 0:i.id,sha:null==s?void 0:s.commit_sha})},[null==s?void 0:s.commit_sha,i]);return{handleOpenPreview:(0,a.useCallback)(e=>{var t;if(e.altKey){window.open(v,"_blank");return}if(x||g){c();return}d("snapshot-preview"),l(r),u(v),o(null!==(t=null==s?void 0:s.id)&&void 0!==t?t:void 0)},[x,g,c,l,d,o,s,r,v,u]),handleOpenCode:(0,a.useCallback)(()=>{var e;let t=!!(null==s?void 0:null===(e=s.diff)||void 0===e?void 0:e.length);f?c():(m(n),d("code"),p(void 0),l(r),o(null==s?void 0:s.id),h(t?I.es.DIFF:I.es.RAW))},[null==s?void 0:null===(t=s.diff)||void 0===t?void 0:t.length,null==s?void 0:s.id,f,m,n,d,p,l,r,o,h,c])}};var eZ=s(36461),eU=s(50618);let eH=e=>{var t,s;let{onClick:n,children:l,edit:o,message:d,code:c,isLoading:u}=e,m=(0,H.iZ)(e=>e.project),{toggleBookmark:p}=(0,eZ.g)((null==m?void 0:m.id)||""),{isActive:h,shouldShowCurrentEditHighlight:g}=ez(o),x=(0,a.useCallback)(e=>{e.stopPropagation(),(null==o?void 0:o.id)&&p(o.id,!!o.bookmarked)},[o,p]);return(0,r.jsxs)("div",{className:"flex w-full items-start gap-1",children:[(0,r.jsxs)("div",{className:"relative w-full",children:[!!o&&(0,r.jsx)(G,{editId:null!==(t=null==o?void 0:o.id)&&void 0!==t?t:void 0,commitSha:null!==(s=null==o?void 0:o.commit_sha)&&void 0!==s?s:void 0,messageId:d.id,code:c}),(0,r.jsx)(w.z,{onClick:n,variant:"outline",className:(0,i.cn)("flex h-auto w-full max-w-56 cursor-pointer gap-2 rounded-xl p-3 text-base font-medium shadow-none sm:max-w-xs md:text-sm",u?"items-center":"items-start","border border-muted-border bg-muted text-foreground","transition-all duration-150 ease-in-out","hover:border-border hover:bg-muted-hover",{"border-affirmative-primary bg-affirmative hover:border-affirmative-primary/80 hover:bg-affirmative/80":g||h,"hover:cursor-auto hover:border-affirmative-primary hover:bg-affirmative":g}),children:l})]}),(null==o?void 0:o.id)&&(0,r.jsx)("div",{className:"flex h-8 w-8 flex-shrink-0 items-center justify-center",children:(0,r.jsx)(eU.Z,{onClick:x,isBookmarked:!!o&&!!o.bookmarked&&(null==o?void 0:o.bookmarked),className:"mt-3"})})]})};var eV=s(89396);let eW=e=>"edit"===e.variant?(0,r.jsx)(eK,{...e}):(0,r.jsx)(eq,{...e}),eK=e=>{let{message:t,edit:s,onClick:a,isActive:n,code:i}=e,l=!0;"aiMessage"===t.type&&(l=i.done||"running"!==t.status);let o=(0,c.zL)(i),d=(0,U.Y)({editId:null==s?void 0:s.id,commitSha:null==s?void 0:s.commit_sha}),u="aiMessage"===t.type&&!t.stopped&&!l;return(0,r.jsxs)(eH,{edit:s,message:t,code:i,onClick:a,isLoading:u,children:[o>0&&(0,r.jsx)("div",{className:"flex h-5 items-center",children:(0,r.jsx)(x.Z,{name:"language",size:"small"})}),l?(0,r.jsx)(eY,{message:t,isCurrentEdit:d,edit:s,isActive:n,code:i}):i&&(0,r.jsx)(eB,{isActive:n,code:i,messageStopped:"aiMessage"===t.type&&t.stopped}),(0,r.jsx)(x.Z,{name:"chevron_right"})]})},eq=e=>{let{message:t,edit:s,onClick:a,isActive:n}=e,i=(0,U.Y)({editId:null==s?void 0:s.id,commitSha:null==s?void 0:s.commit_sha});return(0,r.jsxs)(eH,{edit:s,message:t,code:void 0,onClick:a,isLoading:!1,children:[(0,r.jsx)(eY,{message:t,isCurrentEdit:i,edit:s,isActive:n}),(0,r.jsx)(x.Z,{name:"chevron_right"})]})},eG=(0,a.memo)(e=>{let{message:t,edit:s,code:a}=e,{isActive:n}=ez(s),{handleOpenCode:i,handleOpenPreview:l}=eF({edit:s,messageId:t.id,code:a}),o=(0,N.Z)("md"),{setView:d}=(0,P.zp)(),c="aiMessage"===t.type&&t.persisted;return(0,r.jsx)(u.E.div,{className:"relative flex w-5/6 max-w-xs pb-4",initial:{opacity:c?1:0},animate:{opacity:1},transition:{ease:"easeOut",duration:1},children:(0,r.jsx)(eW,{variant:"edit",code:a,message:t,edit:null!=s?s:null,onClick:e=>{o&&d(P.$.PREVIEW),s?l(e):i()},isActive:n})})});eG.displayName="CodeCard";let eB=(0,a.memo)(e=>{let{isActive:t,code:s,messageStopped:n}=e,[l,o]=(0,a.useState)(""),d=!n;(0,a.useEffect)(()=>{s.parts.length>0&&o(e=>eX(s)||e)},[s]);let c=d?l||"...":l;return(0,r.jsx)("div",{className:"min-h-[1.375rem] min-w-0 flex-1",children:(0,r.jsx)(eR.M,{mode:"popLayout",children:(0,r.jsx)(u.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2},children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("span",{className:(0,i.cn)("truncate text-muted-foreground",{"text-foreground":t}),children:c}),d&&(0,r.jsx)(eL.T,{text:"",className:"mt-0"})]})},c)})})});eB.displayName="EditingTitle";let eY=(0,a.memo)(e=>{let{message:t,edit:s,code:n,isActive:l,isCurrentEdit:o}=e,{title:d,body:u}=(0,a.useMemo)(()=>{let e=void 0!==n?(0,c.zL)(n):0;if(s){var r;return{title:"".concat(null!==(r=s.commit_message)&&void 0!==r?r:"no commit message"),body:o?"Preview Latest":"Preview"}}if(0===e&&"aiMessage"===t.type&&void 0!==t.thinkingTimeMs)return{title:"Saving changes...",body:"View more"};let a="aiMessage"===t.type?t.status:"completed",i="Saving changes...";return"stopped"===a&&(i="Generation stopped"),"completed"!==a||t.editId||(i="Failed to save changes"),{title:"Edited ".concat(e," file").concat(1===e?"":"s"),body:i}},[t,o,s,n]);return(0,r.jsxs)("div",{className:"flex w-full flex-col gap-1 overflow-hidden text-left",children:[(0,r.jsx)("span",{className:(0,i.cn)("truncate",{"text-foreground":l}),children:d}),(0,r.jsx)("span",{className:"truncate font-normal",children:u})]})});eY.displayName="FinishedEditingTitle";let eJ=e=>{if(!e)return"";let t=e.split(/[\/\\]/);return t[t.length-1]},eX=e=>{for(let t=e.parts.length-1;t>=0;t--){let s=e.parts[t];if("writing_file"===s.type||"edit"===s.type)return"Writing ".concat(eJ(s.file_path));if("delete"===s.type)return"Deleting ".concat(eJ(s.file_path));if("rename"===s.type)return"Renaming ".concat(eJ(s.original_file_path));else if("add_dependency"===s.type)return"Installing ".concat(s.dependency);else if("remove_dependency"===s.type)return"Uninstalling ".concat(s.removed_dependency);else if("tool_use"===s.type){let e=(0,eV.fi)(s.name||"",s.parsedData,!1);if(e)return e;{let e=s.name||"";return e.split("-").pop()||e}}}return"Thinking..."};var e$=s(18735);let eQ=e=>{let{name:t,parsedData:s}=e;switch(t){case"lov-view":case"lov-write":case"lov-search-replace":case"lov-line-replace":return(null==s?void 0:s.file_path)||"";default:return""}},e0=e=>["lov-view","lov-write","lov-search-replace","lov-line-replace"].includes(e),e1=e=>["lov-search-replace","lov-line-replace","lov-write","lov-delete","lov-rename"].includes(e),e2=e=>{if(0===e.length)return[];let t=[],s=[],r="";for(let a of e){let e=e0(a.name),n=e?eQ(a):"";if(e&&n&&n===r&&s.length>0)s.push(a);else{if(s.length>0){let e=s[s.length-1],r=s.every(e=>e.done);t.push({...e,done:r})}e&&n?(s=[a],r=n):e||(s=[],r="",t.push(a))}}if(s.length>0){let e=s[s.length-1],r=s.every(e=>e.done);t.push({...e,done:r})}return t},e5=e=>{let{toolUses:t,isShimmering:s}=e,a=t.some(e=>e1(e.name)),n=t.filter(e=>e1(e.name)).length,i=t.length,l=a?n:i,o=a?"".concat(l," edit").concat(1!==l?"s":""," made"):"".concat(l," tool").concat(1!==l?"s":""," used");return(0,r.jsxs)("div",{className:"flex h-6 items-center gap-1.5 whitespace-nowrap text-base font-medium text-muted-foreground md:text-sm",children:[(0,r.jsx)("div",{className:"mb-px mr-1 flex shrink-0 items-center",children:(0,r.jsx)(x.Z,{name:a?"edit_document":"emoji_objects",size:"small",className:"text-muted-foreground"})}),(0,r.jsx)(e$.N,{className:"flex-shrink-0 font-normal",isShimmering:s,children:o})]})},e6=e=>{let{toolUses:t,isStreaming:s=!1,isLastElement:n=!1,messageCompleted:l=!1}=e,[o,d]=(0,a.useState)(!1),c=(0,a.useMemo)(()=>e2(t),[t]),u=(0,a.useMemo)(()=>0===c.length?"":"".concat(c[0].name,"-").concat(Object.keys(c[0].parsedData).join("-")),[c.length>0?c[0].name:"",c.length>0?Object.keys(c[0].parsedData).join("-"):""]),m=n&&!l,p=t.some(e=>!e.done),h=c.length>1,g=(0,a.useRef)(null),[x,f]=(0,a.useState)(0),v=(0,a.useRef)(null),b=(0,a.useCallback)(()=>{v.current&&clearTimeout(v.current),v.current=setTimeout(()=>{g.current&&f(g.current.scrollHeight)},50)},[]);if((0,a.useEffect)(()=>()=>{v.current&&clearTimeout(v.current)},[]),(0,a.useEffect)(()=>{g.current&&f(g.current.scrollHeight)},[g,o,c]),0===c.length)return null;if(!h)return(0,r.jsx)(eV.Y9,{name:c[0].name,parsedData:c[0].parsedData,done:c[0].done,isShimmering:m,duration:c[0].duration,collapsed:!1});let j=c[c.length-1];return(0,r.jsxs)("div",{className:"relative flex w-full flex-col",children:[(0,r.jsx)(w.z,{onClick:()=>d(!o),variant:"outline",className:(0,i.cn)("absolute right-0 top-0 z-10 flex h-6 items-center justify-center px-1.5 py-1 text-base font-normal transition-all duration-300 ease-out md:text-sm"),"aria-label":o?"Collapse tool uses":"Expand tool uses",children:o?"Hide":"Show all"}),(0,r.jsx)("div",{className:"relative overflow-hidden transition-all duration-300 ease-in-out",style:{height:o?"".concat(x,"px"):"24px"},children:o?(0,r.jsx)("div",{ref:g,className:"absolute top-0 flex w-full flex-col gap-2",children:c.map((e,t)=>(0,r.jsx)("div",{className:"transition-all duration-300 ease-out",children:(0,r.jsx)(eV.Y9,{collapsed:!1,onHeightChange:b,name:e.name,parsedData:e.parsedData,done:e.done,isShimmering:m&&t===c.length-1&&!e.done,duration:e.duration})},"".concat(u,"-").concat(t)))}):(0,r.jsx)("div",{className:"flex h-full items-end",children:p||!l&&n?(0,r.jsx)("div",{className:"flex h-6 items-center",children:(0,r.jsx)(eV.Y9,{name:j.name,parsedData:j.parsedData,done:j.done,isShimmering:m&&!j.done,duration:j.duration,collapsed:!0})}):(0,r.jsx)(e5,{toolUses:c,isShimmering:!1})})})]})},e4=(0,a.memo)(e=>{let{mermaid:t,className:s}=e,{setActiveMermaidContent:a,setShowConsole:n}=(0,k.pE)(),l=e=>{if(!e)return"Diagram";let t=e.trim().toLowerCase();return t.startsWith("graph")?"Flowchart":t.startsWith("sequencediagram")?"Sequence":t.startsWith("classdiagram")?"Class":t.startsWith("erdiagram")?"Entity Relationship":t.startsWith("journey")?"User Journey":t.startsWith("gitgraph")?"Git Graph":t.startsWith("pie")?"Pie Chart":t.startsWith("gantt")?"Gantt Chart":t.startsWith("statediagram")?"State":t.startsWith("mindmap")?"Mind Map":"Diagram"},o=l(t.mermaidCode),d=!t.done;return(0,r.jsx)(u.E.div,{className:"relative flex w-5/6 max-w-xs pb-4",initial:{opacity:0},animate:{opacity:1},transition:{ease:"easeOut",duration:1},children:(0,r.jsx)(w.z,{onClick:e=>{var s;e.stopPropagation(),t.done&&(a(t),n("mermaid"),z.ZP.capture(R.SL.MERMAID.DIAGRAM_OPENED,{diagram_type:l(t.mermaidCode),code_length:(null===(s=t.mermaidCode)||void 0===s?void 0:s.length)||0}))},variant:"outline",className:(0,i.cn)("flex h-auto w-full cursor-pointer gap-2 rounded-xl p-3 text-sm font-medium shadow-none",d?"items-center":"items-start","border border-muted-border bg-muted text-foreground","transition-all duration-150 ease-in-out",d?"opacity-60 hover:border-muted-border hover:bg-muted":"hover:border-border hover:bg-muted-hover",s),disabled:d,children:d?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"flex h-5 items-center",children:(0,r.jsx)(x.Z,{name:"progress_activity",size:"small",className:"animate-spin"})}),(0,r.jsx)("span",{className:"flex-1 text-left",children:"Generating diagram..."})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"flex h-5 items-center",children:(0,r.jsx)(x.Z,{name:"auto_stories",size:"small"})}),(0,r.jsx)("span",{className:"flex-1 text-left",children:o}),(0,r.jsx)(x.Z,{name:"chevron_right"})]})})})}),e7=e=>{let{codeContent:t}=e,[s,n]=(0,a.useState)(!1),i=async()=>{await navigator.clipboard.writeText(String(t)),n(!0),setTimeout(()=>n(!1),2e3)},{resolvedTheme:l}=(0,m.F)(),o="dark"===l?f.A:f.g;return(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("button",{className:"hover:bg-card-hover absolute right-2 top-2 rounded-md bg-secondary p-1 transition-colors",onClick:i,children:(0,r.jsx)(x.Z,{name:s?"check":"content_copy",className:"h-4 w-4 text-foreground transition-all duration-300"})}),(0,r.jsx)("div",{className:"max-w-full overflow-x-auto",children:(0,r.jsx)(h.Z,{children:String(t).replace(/\n$/,""),style:o,language:"sql",wrapLongLines:!0,PreTag:"div"})})]})};function e3(e){return"input"===e.type||"secret"===e.type}let e8=e=>{var t,s;let{message:a,toolUse:n}=e,i=(0,ex.cI)(),l=(0,C.D)(),{mutateAsync:o,isPending:d}=(0,em.mo)({projectId:l}),c=async e=>{await o({body:{message:"Please apply the changes.",id:(0,e_.Fd)(),mode:eI.S.INSTANT,prev_session_id:a.id,user_input:e},projectId:l})},u=null!==(s=null===(t=n.userInput)||void 0===t?void 0:t.filter(e3).map(e=>{let t=e.data;return i.register(t.name,{...t,pattern:t.pattern?new RegExp(t.pattern):void 0})}))&&void 0!==s?s:[];return(0,r.jsx)("div",{className:"relative",children:(0,r.jsx)("div",{className:"max-w-full",children:n.userInput&&(0,r.jsx)(ev.l0,{...i,children:(0,r.jsx)("form",{onSubmit:i.handleSubmit(c),children:n.userInput.map((e,t)=>{switch(e.type){case"instructions":return(0,r.jsx)(_,{displayCursor:!1,persisted:a.persisted,children:e.data.text},t);case"input":case"secret":let s=u.find(t=>t.name===e.data.name);if(!s)return null;return(0,r.jsx)(ev.Wi,{control:i.control,name:s.name,render:t=>{let{field:s}=t;return(0,r.jsxs)(ev.xJ,{className:"mt-2 flex flex-col gap-0 rounded-2xl bg-secondary p-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)(ev.lX,{className:"ml-0.5 flex items-center gap-1 text-base font-normal",children:[(0,r.jsx)("span",{className:"align-text-bottom leading-loose",children:e.data.label}),e.data.helpLink&&(0,r.jsx)(w.z,{variant:"ghost",size:"icon-sm",className:"-6 h-6 hover:bg-transparent",children:(0,r.jsx)(Q.default,{href:e.data.helpLink,target:"_blank",rel:"noopener noreferrer",children:(0,r.jsx)(x.Z,{name:"help",size:"small"})})})]}),e.data.link&&(0,r.jsx)(w.z,{variant:"ghost",size:"icon-sm",className:"flex h-6 items-center gap-1 font-normal text-muted-foreground hover:bg-transparent",asChild:!0,children:(0,r.jsxs)(Q.default,{href:e.data.link,target:"_blank",rel:"noopener noreferrer",children:[e.data.linkTitle||"Learn more",(0,r.jsx)(x.Z,{name:"arrow_outward",size:"small"})]})})]}),(0,r.jsx)(ev.NI,{children:(0,r.jsxs)("div",{className:"mt-0 flex items-center gap-2",children:[(0,r.jsx)(eb.I,{className:"h-8 bg-background",...s}),(0,r.jsx)(w.z,{type:"submit",variant:"affirmative",className:"gap-2",disabled:d,children:"Approve"})]})}),(0,r.jsx)(ev.zG,{})]})}});default:return null}})})})})})},e9=e=>"parts"in e&&"done"in e,te=e=>"lovSql"in e&&"done"in e,tt=e=>"lov-supabase-migration"===e.name,ts=e=>"mermaidCode"in e&&"done"in e,tr=e=>{var t;let{message:s,edit:a,messageParts:n}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ta,{message:s,messageParts:n,edit:a}),s.stopped&&(0,r.jsx)("div",{className:"mt-2",children:(0,r.jsx)("span",{className:"inline-flex items-center text-muted-foreground",children:"This message was cancelled."})}),s.errors&&(0,r.jsx)(X,{edit:a,messageParts:n,errors:null!==(t=s.errors)&&void 0!==t?t:null}),(0,r.jsx)(eD,{message:s,messageId:s.id,lovActions:null==n?void 0:n.lovActions,sqlRunState:s.sqlRunState,persisted:s.persisted})]})},ta=e=>{let{message:t,messageParts:s,edit:a}=e;if(!s)return t.content.length>0?(0,r.jsx)(_,{displayCursor:!1,persisted:t.persisted,children:t.content||""}):null;let n=[],i=[],l=s.parts.some(e=>(0,c.Cg)(e)&&!e.done),o=e=>{i.length>0&&(n.push((0,r.jsx)(e6,{toolUses:i,isStreaming:l,isLastElement:e,messageCompleted:t.persisted},"tool-group-".concat(n.length))),i=[])},d=e=>"content"in e&&""===e.content.trim();for(let e=0;e<s.parts.length;e++){let l=s.parts[e];if((0,c.Cg)(l)){if(l.failed)continue;if(l.requiresApproval&&!tt(l)){o(!1),n.push((0,r.jsx)(e8,{message:t,toolUse:l},e));continue}if(i.length,i.push({name:l.name,parsedData:l.parsedData,done:l.done,duration:l.duration}),tt(l)&&l.parsedData&&l.parsedData.query){let t=l.parsedData.query.replace(/\\n/g,"\n").replace(/\\t/g,"	").replace(/\\r/g,"\r");n.push((0,r.jsx)(e7,{codeContent:t},e))}}else if(!d(l)){if(o(!1),e9(l))n.push((0,r.jsx)(eG,{message:t,edit:a,code:l},e));else if(te(l))n.push((0,r.jsx)(e7,{codeContent:l.lovSql},e));else if(ts(l))n.push((0,r.jsx)(e4,{mermaid:l},e));else if("content"in l)n.push((0,r.jsx)(_,{displayCursor:!1,persisted:t.persisted,children:l.content},e));else throw Error("Unknown part type")}}return o(!0),(0,r.jsx)(r.Fragment,{children:n})};var tn=s(92850),ti=s(33187),tl=s(19060),to=s(26815);function td(e){let{open:t,onOpenChange:s,onFeedbackSubmit:n,onSkip:i}=e,[l,o]=(0,a.useState)([]),[d,c]=(0,a.useState)(""),u=e=>{o(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])};return(0,r.jsx)(ed.Vq,{open:t,onOpenChange:e=>{e||n({selectedOptions:[],comment:"",action:"close"}),s(e),o([]),c("")},children:(0,r.jsxs)(ed.cZ,{className:"bg-background",size:"md",children:[(0,r.jsx)(ed.fK,{children:(0,r.jsx)(ed.$N,{className:"text-3xl font-medium",children:"Give feedback"})}),(0,r.jsx)("div",{className:"grid gap-4 py-4",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:["We're sorry it didn't meet your expectations. ",(0,r.jsx)("br",{}),"Your feedback helps us improve Lovable and your experience. Please tell us what went wrong."]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium",children:"What happened?"}),(0,r.jsx)("div",{className:"space-y-2.5",children:[{id:"incorrect-solution",label:"Missunderstood the task"},{id:"missing-functionality",label:"Some functionalities were missing"},{id:"design-not-as-expected",label:"Design wasn't as expected"},{id:"other",label:"Other"}].map(e=>(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(tl.X,{id:e.id,checked:l.includes(e.id),onCheckedChange:()=>u(e.id)}),(0,r.jsx)(to.Label,{htmlFor:e.id,className:"cursor-pointer",children:e.label})]},e.id))})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("p",{className:"feedback text-sm font-medium",children:"What can we improve?"}),(0,r.jsx)(ec.g,{id:"feedback",placeholder:"Your feedback...",className:"min-h-[100px]",value:d,onChange:e=>c(e.target.value)})]})]})}),(0,r.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,r.jsx)(w.z,{variant:"outline",onClick:()=>{i(),n({selectedOptions:[],comment:"",action:"skip"}),o([]),c("")},children:"Skip"}),(0,r.jsx)(w.z,{onClick:()=>{n({selectedOptions:l,comment:d,action:"submit"}),o([]),c("")},children:"Submit"})]})]})})}var tc=e=>{let{messageId:t}=e,[s,n]=(0,a.useState)(!1),[i,o]=(0,a.useState)(!1),[d,c]=(0,a.useState)(!1),u=(0,l.aK)(e=>e.sortedMessageIds),m=(0,C.D)(),p=u.length,{data:h,isLoading:g}=(0,tn.a)(ti.W.feedbackStatus({projectId:m})),f=(0,eg.D)({mutationFn:async()=>{let e=(0,ey.SJ)();return(await e.post("/user/feedback-status",{has_submitted_feedback:!0})).data},onError:e=>{(0,ej.Eo)(e)}}),v=(0,a.useCallback)(async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"thumbs_up";if(!i){try{await f.mutateAsync(),b({isPositive:e,selectedOptions:null==t?void 0:t.selectedOptions,comment:null==t?void 0:t.comment,action:s})}catch(e){}o(!0),n(!1)}},[i,f,o,n]);(0,a.useEffect)(()=>{!i&&(null==h?void 0:h.is_free_user)&&u.length>=3&&(v(!0,void 0,"continued_chat"),c(!0))},[u.length,i,null==h?void 0:h.is_free_user,v]);let b=e=>{z.ZP.capture("first_prompt_result_feedback",{messageId:t,...e})},j=async()=>{try{await f.mutateAsync(),b({isPositive:!1,action:"skip"})}catch(e){}o(!0),n(!1)};return g||!(null==h?void 0:h.is_free_user)||(null==h?void 0:h.has_submitted_feedback)||d||p>2?null:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"relative flex max-w-full flex-row items-center justify-between gap-2 rounded-lg border border-muted-border p-3",children:i?(0,r.jsx)("p",{className:"text-sm",children:"Thank you for your feedback! It helps make Lovable better."}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"text-sm",children:"Did Lovable build what you wanted?"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(w.z,{variant:"outline",size:"sm",className:"h-7 w-7 flex-1 cursor-pointer border-neutral-700 bg-gray-900 py-1 text-xs hover:border-gray-300 hover:bg-gray-600",onClick:()=>v(!0),children:(0,r.jsx)(x.Z,{name:"thumb_up-fill",className:"h-3.5 w-3.5",fill:"white"})}),(0,r.jsx)(w.z,{variant:"outline",size:"sm",className:"h-7 w-7 flex-1 cursor-pointer border-neutral-700 bg-gray-900 py-1 text-xs hover:border-gray-300 hover:bg-gray-600",onClick:()=>n(!0),children:(0,r.jsx)(x.Z,{name:"thumb_down-fill",className:"h-3.5 w-3.5",fill:"white"})})]})]})}),(0,r.jsx)(td,{open:s,onOpenChange:e=>{n(e),e||o(!0)},onFeedbackSubmit:e=>v(!1,e,e.action),onSkip:j})]})};let tu={},tm=e=>{let{message:t,isFirstAIMessage:s}=e,n=(0,l.tV)(t.editId),u=t.timeToFirstTokenMs;void 0===u?tu[t.id]=!0:tu[t.id]&&(tu[t.id]=!1);let m=(0,a.useMemo)(()=>t.content?function(e,t){if((null==e?void 0:e.parts.length)&&e.parts.length>0){let s=e.parts.find(e=>"object"==typeof e&&"type"in e&&"tool_use"===e.type&&"duration"in e);if(s){if(!t)return s.duration=void 0,e;let r=s.duration+Math.floor(t/1e3);s.duration=r}}return e}((0,c.hP)(t.content),u):null,[t.id,t.content,u]),p=(0,o.dl)(d.P.FeedbackFormFirstPrompt);return(0,r.jsxs)("div",{className:(0,i.cn)("flex flex-col space-y-4 overflow-auto pl-8 text-left text-base leading-[22px]"),style:{overflowWrap:"anywhere"},children:[(0,r.jsx)(tr,{message:t,edit:n,messageParts:m}),p&&s&&"completed"==t.status&&(0,r.jsx)(tc,{messageId:t.id})]})},tp=e=>{let{branchName:t}=e;return(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{children:"Switched branch to"}),(0,r.jsx)("div",{className:"flex items-center gap-2 rounded-full border border-muted-border bg-muted px-2 py-0.5",children:(0,r.jsx)("p",{children:t})})]})};var th=s(25658),tg=s(41135),tx=s(3813),tf=s(47902),tv=s(55721),tb=s(79358);let tj=e=>{let{remixedProjectId:t,isLoading:s=!1}=e;return(0,r.jsxs)(ed.cZ,{children:[(0,r.jsxs)(ed.fK,{children:[(0,r.jsx)(ed.$N,{children:s?"Remixing Project Snapshot...":"Project Snapshot Remixed Successfully"}),(0,r.jsx)(ed.Be,{children:s?"Please wait while we remix your project snapshot. This may take a moment.":"Your project snapshot has been remixed to your local development environment."})]}),(0,r.jsx)(ed.cN,{children:s?(0,r.jsxs)(w.z,{disabled:!0,children:[(0,r.jsx)(x.Z,{name:"progress_activity",size:"small",className:"animate-spin"}),"Remixing..."]}):(0,r.jsx)(w.z,{asChild:!0,children:(0,r.jsx)("a",{href:"http://localhost:3000/projects/".concat(t),target:"_blank",rel:"noreferrer",children:"Open Remixed Project"})})})]})};var ty=s(49968),t_=s(88391),tw=s(35974),tN=s(67817);let tE=e=>"https://us.posthog.com/project/47074/llm-observability/traces/".concat(e),tC=e=>{let{className:t}=e;return(0,r.jsx)(tw.C,{variant:"outline",className:t,children:"ADMIN"})},tS=e=>{let{messageId:t,editId:s}=e,n=(0,C.D)(),i=(0,tN.v)(),{setActiveMessageId:l,setShowConsole:o}=(0,k.pE)(),d=(0,t_.z)(tj),[c,u]=(0,a.useState)(!1),m=async()=>{d({childProps:{isLoading:!0}}),u(!0);try{let e=(0,ey.SJ)(),s=await e.post("/projects/".concat(n,"/remix/snapshot"),{message_id:t,keep_supabase_connection:!0});d({childProps:{remixedProjectId:s.project_id,isLoading:!1}})}catch(e){eo.Am.error("Failed to remix project snapshot",{description:"An error occurred while remixing the project snapshot to local development."}),d(!1)}finally{u(!1)}};return i?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(tv.VD,{}),(0,r.jsxs)(tv.Xi,{className:"w-full gap-2",onClick:()=>{l(t),o("debug")},children:[(0,r.jsx)(x.Z,{name:"bug_report",size:"small"}),(0,r.jsx)("span",{children:"Debug"}),(0,r.jsx)(tC,{className:"ml-auto"})]}),(0,r.jsxs)(tv.Xi,{className:"w-full gap-2",onClick:()=>{l(t),o("annotation")},children:[(0,r.jsx)(x.Z,{name:"edit",size:"small"}),(0,r.jsx)("span",{children:"Annotate"}),(0,r.jsx)(tC,{className:"ml-auto"})]}),(0,r.jsxs)(tv.Xi,{className:"w-full gap-2",onClick:m,disabled:c,children:[(0,r.jsx)(x.Z,{name:"refresh",size:"small",className:c?"animate-spin":""}),(0,r.jsx)("span",{children:c?"Remixing...":"Remix Snapshot to Local"}),(0,r.jsx)(tC,{className:"ml-auto"})]}),i&&(0,r.jsx)(tv.Xi,{className:"w-full gap-2",asChild:!0,children:(0,r.jsxs)("a",{href:tE(t),target:"_blank",rel:"noreferrer",children:[(0,r.jsx)(x.Z,{name:"arrow_outward",size:"small"}),(0,r.jsx)("span",{children:"Posthog: View LLM Trace"}),(0,r.jsx)(tC,{className:"ml-auto"})]})}),(0,r.jsx)(tv.Xi,{className:"w-full gap-2",asChild:!0,children:(0,r.jsxs)("a",{href:(0,ty.pr)(n,t),target:"_blank",rel:"noreferrer",children:[(0,r.jsx)(x.Z,{name:"arrow_outward",size:"small"}),(0,r.jsx)("span",{children:"Firestore: Message"}),(0,r.jsx)(tC,{className:"ml-auto"})]})}),s&&(0,r.jsx)(tv.Xi,{className:"w-full gap-2",asChild:!0,children:(0,r.jsxs)("a",{href:(0,ty.oo)(n,s),target:"_blank",rel:"noreferrer",children:[(0,r.jsx)(x.Z,{name:"arrow_outward",size:"small"}),(0,r.jsx)("span",{children:"Firestore: Edit"}),(0,r.jsx)(tC,{className:"ml-auto"})]})})]}):null};var tk=s(6478);let tI=e=>{let{messageId:t}=e,s=(0,C.D)(),n=(0,tk.F)(),i=(0,a.forwardRef)((e,t)=>(0,r.jsx)(tv.Xi,{ref:t,...e,children:(0,r.jsxs)("div",{className:"flex w-full justify-between gap-4",onClick:()=>{z.ZP.capture(R.SL.ELLIPSIS.COPY_LINK_CLICKED)},children:[(0,r.jsx)("span",{children:"Copy message link"}),(0,r.jsx)(x.Z,{name:"link",size:"small",className:"ml-auto"})]})}));i.displayName="TriggerComponent";let l=n({TriggerComponent:i,textToCopy:"".concat(window.location.origin,"/projects/").concat(s,"?messageId=").concat(t)});return(0,r.jsxs)(D.u,{children:[(0,r.jsx)(D.aJ,{asChild:!0,children:l}),(0,r.jsx)(D._v,{children:"Copy link to clipboard"})]})},tA=e=>{let{commitSha:t,previewBuildStatus:s}=e,r=(0,H.iZ)(e=>{var t;return null===(t=e.project)||void 0===t?void 0:t.latest_commit_sha}),{project_id:n}=(0,L.useParams)(),i=(0,H.iZ)(e=>{var t;return null===(t=e.project)||void 0===t?void 0:t.name}),l=t===r,o=(0,a.useMemo)(()=>{if(t&&i)return(0,eO.t)({projectName:i,sha:t})},[t,i]),{isDisabled:d,disabledReason:c}=(0,a.useMemo)(()=>"pending"===s?{isDisabled:!0,disabledReason:"Preview is being built..."}:"failed"===s?{isDisabled:!0,disabledReason:"Failed to build preview"}:o?{isDisabled:!1,disabledReason:void 0}:{isDisabled:!0,disabledReason:"There is no preview available for this version"},[o,s]),u=(0,a.useCallback)(e=>{let{eventName:s}=e;z.ZP.capture(s,{commit_sha:t,disabled:d,disabled_reason:c,is_latest_commit:l,preview_url:o,project_id:n})},[t,c,d,l,o,n]);return{previewUrl:o,isLatestCommit:l,isDisabled:d,disabledReason:c,onPreview:u}},tP=e=>{let{commitSha:t,previewBuildStatus:s}=e,{previewUrl:a,isDisabled:n,onPreview:i}=tA({commitSha:t,previewBuildStatus:s});return(0,r.jsx)(tv.Xi,{asChild:!0,disabled:n,children:(0,r.jsxs)("a",{className:"w-full",href:a,target:"_blank",rel:"noreferrer",onClick:()=>i({eventName:R.SL.ELLIPSIS.PREVIEW_CLICKED}),children:["Preview",(0,r.jsx)(x.Z,{name:"arrow_outward",className:"ml-auto",size:"small"})]})})},tM=e=>{let{editId:t,commitSha:s}=e,{onRevert:a,isDisabled:n}=V({editId:t,commitSha:s});return(0,r.jsxs)(tv.Xi,{className:"w-full",onClick:()=>a&&a({eventName:R.SL.ELLIPSIS.RESTORE_CLICKED}),disabled:n,children:["Restore",(0,r.jsx)(x.Z,{name:"restart_alt",className:"ml-auto",size:"small"})]})},tT=e=>{let{messageId:t,editId:s,costCredits:a,className:n,createdAt:i,senderName:o="Lovable"}=e,d=(0,l.tV)(s);return(0,r.jsxs)(tv.h_,{children:[(0,r.jsx)(tv.$F,{asChild:!0,className:n,children:(0,r.jsx)(w.z,{variant:"ghost",size:"icon-sm",children:(0,r.jsx)(x.Z,{name:"more_horiz",size:"small"})})}),(0,r.jsxs)(tv.AW,{align:"end",children:[(0,r.jsx)(tI,{messageId:t}),(0,r.jsx)(tP,{commitSha:null==d?void 0:d.commit_sha}),(0,r.jsx)(tM,{editId:s,commitSha:null==d?void 0:d.commit_sha}),void 0!==a&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(tv.VD,{}),(0,r.jsxs)(tv.Xi,{className:"cursor-default justify-between focus:bg-transparent focus:text-foreground",onSelect:e=>e.preventDefault(),children:[(0,r.jsx)("span",{children:"Credits used"}),(0,tb.H)(a)]})]}),(0,r.jsx)(tS,{messageId:t,editId:s})]})]})},tD=e=>e<1e3?"1s":e<6e4?"".concat((e/1e3).toFixed(0),"s"):"".concat(Math.floor(e/6e4),"m ").concat(Math.floor(e%6e4/1e3),"s"),tR=e=>"userCommit"!==e.type&&"userMessage"!==e.type,tL=e=>{let{previousMessageId:t}=e,s=(0,l.aK)(e=>t?e.messages[t]:void 0);return s&&"revertSuccess"!==s.type&&!tR(s)?(0,r.jsx)(tO,{className:"mb-2"}):null},tz=e=>{let{message:t}=e,s=(0,th.z)(e=>e.showHistory),a=(0,tx.zq)();return s?null:(0,r.jsxs)("div",{className:"mb-3 flex shrink-0 items-center gap-1 text-ellipsis text-nowrap text-muted-foreground md:text-sm",children:[(0,r.jsxs)("div",{className:"flex w-full items-center leading-none",children:[(0,r.jsx)(tO,{className:"shrink-0 leading-none"}),a&&void 0!==t.thinkingTimeMs&&t.thinkingTimeMs>0&&("completed"===t.status||"stopped"===t.status)&&(0,r.jsxs)("span",{className:"ml-2 mt-px whitespace-nowrap opacity-100 transition-opacity duration-150 ease-out group-hover:opacity-100 md:opacity-0",children:["Worked for ",tD(t.thinkingTimeMs)]}),(0,r.jsxs)(D.u,{children:[(0,r.jsx)(D.aJ,{asChild:!0,children:(0,r.jsx)("span",{className:(0,i.cn)("ml-auto mt-px flex-shrink cursor-default overflow-hidden opacity-100 transition-opacity duration-150 ease-out group-hover:opacity-100 md:opacity-0"),children:(0,tf._g)(t.createdAt)})}),(0,r.jsx)(D._v,{children:t.createdAt.toLocaleString()})]})]}),(0,r.jsx)(tT,{className:"ml-auto",messageId:t.id,editId:t.editId,costCredits:t.costCredits,createdAt:t.createdAt})]})},tO=e=>{let{className:t}=e;return(0,r.jsxs)("div",{className:(0,i.cn)("flex items-center gap-2 pl-2",t),children:[(0,r.jsx)(tg.xx,{className:(0,i.cn)("mr-1.5 h-3.5 md:mr-1")}),(0,r.jsx)("span",{className:(0,i.cn)("whitespace-nowrap text-lg font-medium md:text-base"),children:"Lovable"})]})};var tF=s(52558),tZ=s(7455),tU=s(71759),tH=s(70335);let tV=e=>{let{message:t}=e,{authUser:s}=(0,tF.Eu)(),a=(0,tZ.c)(e=>e.collaborators).find(e=>e.id===t.userId),n=(0,tU.hO)(e=>e.memberships).find(e=>e.user_id===t.userId),i=a||n;if((null==a?void 0:a.id)===(null==s?void 0:s.uid)||(null==n?void 0:n.user_id)===(null==s?void 0:s.uid)||!i)return null;let l=i.display_name===t.userId?i.email:i.display_name;return(0,r.jsxs)("div",{className:"mt-4 flex max-w-full items-center gap-1.5 self-start truncate pl-2 text-sm font-medium",children:[(0,r.jsx)(tH.Y,{user:{id:t.userId||"",username:l||""},className:"h-5 w-5 text-xs"}),(0,r.jsx)(Q.default,{className:"min-w-0 truncate hover:underline",href:"/@".concat(i.username),children:l})]})},tW=e=>{let{message:t,previousMessageId:s}=e;switch(t.type){case"userCommit":return null;case"userMessage":return(0,r.jsx)(tV,{message:t});case"branchSwitched":case"revertSuccess":return(0,r.jsx)(tL,{message:t,previousMessageId:s});case"aiMessage":return(0,r.jsx)(tz,{message:t})}};var tK=s(22048),tq=s(96771);let tG=e=>{let{shortCommitHash:t,scrollToEdit:s,newUI:i=!1}=e,{loadMessagesFromId:o}=(0,l.mx)(),{setCodeViewType:d}=(0,I.VK)(),{setActiveMessageId:c,setActiveEditId:m,setShowConsole:p,exitConsole:h}=(0,k.pE)(),g=(0,l.uO)(t),f=(0,k.Sl)(e=>e.consoleContentType),v=(0,k.Sl)(e=>e.activeMessageId),b=(0,l.Fm)(null==g?void 0:g.id),j=v===(null==g?void 0:g.id)&&"code"===f,[y,_]=(0,a.useState)("idle");(0,a.useEffect)(()=>{j&&m(null==g?void 0:g.id)},[j,g,m]);let w=(0,a.useCallback)(()=>{g&&(j?(z.ZP.capture(R.SL.CONSOLE.EXITED_VIA_CARD),h()):(z.ZP.capture(R.SL.CODE_CARD.VIEW_CODE_CLICKED),c(g.id),d(I.es.DIFF),m(g.id),p("code")))},[g,j,h,c,d,m,p]);if(!g)return null;let N=async()=>{_("loading");try{g.type===tq.I.type.DEVELOPER_UPDATE?(await o({messageId:g.id,id_type:"edit_id"}),s({type:"shortCommitHash",value:t})):(await o({messageId:g.id,id_type:"edit_id"}),s({type:"editId",value:g.id})),_("success")}catch(e){eo.Am.error("Could not scroll to edit. Try refreshing the page."),_("error"),n.logging.warn("Firestore error - RevertChipV2 - scroll to edit",{error:e,editId:null==g?void 0:g.id,shortCommitHash:t})}},E="loading"===y;return i?b?"aiMessage"!==b.type?(tK.Tb(Error("RevertChip: message is not an AI message"),{level:"error"}),null):(0,r.jsx)("div",{className:"flex flex-col gap-2 leading-[22px]",style:{overflowWrap:"anywhere"},children:(0,r.jsxs)(u.E.div,{className:"relative mb-6 mt-3 flex w-5/6 max-w-sm",initial:{opacity:1},animate:{opacity:1},transition:{ease:"easeOut",duration:1},children:[E&&(0,r.jsx)("div",{className:"absolute inset-0 z-10 flex items-center justify-center rounded-md bg-background/80",children:(0,r.jsx)(x.Z,{className:"animate-spin",name:"progress_activity",size:"small"})}),(0,r.jsx)(eW,{variant:"revert",message:b,edit:g,onClick:w,isActive:j})]})}):null:(0,r.jsxs)("button",{className:"flex items-center disabled:opacity-50",onClick:N,disabled:E,children:[(0,r.jsx)("span",{className:"ml-6 mr-2 text-sm text-muted-foreground",children:"Restored"}),(0,r.jsxs)("div",{className:"flex items-center gap-2 rounded-full border border-muted-border bg-muted px-3 py-1.5 transition-colors hover:bg-muted-hover",children:[(0,r.jsx)("span",{className:"max-w-xs truncate text-sm",title:g.commit_message,"aria-label":g.commit_message,children:g.commit_message}),E&&(0,r.jsx)(x.Z,{className:"ml-1 animate-spin",name:"progress_activity",size:"small"})]})]})},tB=e=>{var t,s,a;let{message:n}=e,o=(0,l.uO)(n.shortCommitHash),d={done:!0,parts:null!==(s=null==o?void 0:null===(t=o.diff)||void 0===t?void 0:t.map(e=>({type:"writing_file",file_path:e.file_path,done:!0,content:e.new_content})))&&void 0!==s?s:[]},c=(0,U.Y)({editId:null==o?void 0:o.id,commitSha:null==o?void 0:o.commit_sha}),{isActive:m}=ez(o),p=eF({edit:o,messageId:n.id,code:d});return o?(0,r.jsx)(u.E.div,{className:"relative ml-6 flex w-5/6 max-w-xs pb-4",initial:{opacity:1},animate:{opacity:1},transition:{ease:"easeOut",duration:1},children:(0,r.jsxs)(eH,{edit:o,message:n,code:d,onClick:p.handleOpenPreview,children:[(0,r.jsx)("div",{className:"flex h-5 items-center",children:(0,r.jsx)(tg.xR.GitHub,{className:"mt-px h-4 w-4 text-foreground"})}),(0,r.jsxs)("div",{className:"flex w-full flex-col gap-1 overflow-hidden text-left",children:[(0,r.jsx)("span",{className:(0,i.cn)("truncate",{"text-foreground":m}),children:null!==(a=o.commit_message)&&void 0!==a?a:"No commit message"}),(0,r.jsx)("span",{className:"truncate font-normal",children:c?"Active Edit":"See Preview"})]}),(0,r.jsx)(x.Z,{name:"chevron_right"})]})}):null};var tY=s(42503),tJ=s(66491);let tX=(0,a.memo)(e=>{var t;let{messageId:s,edit:n,simplified:o=!1}=e,{commit_sha:d}=null!=n?n:{},{setActiveEditId:c}=(0,k.pE)(),u=(0,k.Sl)(e=>e.activeEditId),m=(0,l.aK)(e=>e.edits),p=u?m[u]:null,h=(0,H.iZ)(e=>e.project),{setActiveMessageId:g,setShowConsole:x,setConsolePreviewContent:f,exitConsole:v}=(0,k.pE)(),b=(0,k.Sl)(e=>e.consoleContentType),{toggleBookmark:j}=(0,eZ.g)((null==h?void 0:h.id)||""),y=(0,a.useMemo)(()=>{if(d&&h)return(0,eO.t)({projectId:null==h?void 0:h.id,sha:d})},[d,h]),_=(0,U.Y)({editId:null==n?void 0:n.id,commitSha:null!==(t=null==n?void 0:n.commit_sha)&&void 0!==t?t:void 0}),N=n&&(null==p?void 0:p.id)===(null==n?void 0:n.id)&&"snapshot-preview"===b||_&&!p&&!b,E=(0,a.useMemo)(()=>{if(!(null==n?void 0:n.created_at))return null;let e=new Date(1e3*n.created_at.seconds);return{relative:(0,tY.l)(e,new Date),absolute:(0,tJ.WU)(e,"MMM d, yyyy, h:mm a")}},[n]),C=(0,a.useCallback)(e=>{var t;if(e.altKey){window.open(y,"_blank");return}if(N||_){v();return}x("snapshot-preview"),g(s),f(y),c(null!==(t=null==n?void 0:n.id)&&void 0!==t?t:void 0)},[n,v,N,_,s,y,c,g,f,x]),S=(0,a.useCallback)(e=>{e.stopPropagation(),(null==n?void 0:n.id)&&j(n.id,!!n.bookmarked)},[n,j]),I=(0,a.useMemo)(()=>{if(n){let{commit_message:e,reverted:t}=null!=n?n:{};return(0,r.jsxs)("div",{className:"flex w-full flex-col gap-1 overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-x-2 gap-y-1",children:[(0,r.jsx)("span",{className:"flex items-center gap-1 truncate",children:e}),(_||t)&&!o&&(0,r.jsx)(tw.C,{className:"border-0 py-0",variant:_?"default":"destructive",children:_?"Current":"Reverted"})]}),(0,r.jsx)("span",{className:"text-sm font-normal text-muted-foreground",children:E?(0,r.jsx)(r.Fragment,{children:E.absolute}):N?"Click to Exit Preview":"Click to Preview"})]})}return(0,r.jsxs)("div",{className:"flex w-full flex-col overflow-hidden",children:[(0,r.jsx)("span",{children:"No preview available"}),(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:"\xa0"})]})},[n,N,_,E,o]);return(0,r.jsxs)(w.z,{onClick:C,disabled:!n,className:(0,i.cn)("mb-2 flex h-auto w-full cursor-pointer items-start gap-2 rounded-lg p-3 text-left text-sm font-medium transition-colors duration-150 ease-in-out","border border-muted-border bg-muted text-foreground","hover:border-border hover:bg-muted-hover",{"border-affirmative-primary bg-affirmative hover:border-affirmative-primary hover:bg-affirmative/80":N},{"hover:cursor-auto hover:bg-affirmative":N&&_}),children:[(0,r.jsx)(eU.Z,{onClick:S,isBookmarked:!!n&&!!n.bookmarked&&(null==n?void 0:n.bookmarked),className:"mt-[3px]"}),I]})});tX.displayName="LegacyPreviewCard";let t$=e=>{var t;let{message:s}=e,a=(0,l.tV)(s.editId);return(null==a?void 0:null===(t=a.diff)||void 0===t?void 0:t.length)?(0,r.jsx)(eG,{code:{done:!0,parts:a.diff.map(e=>({type:"writing_file",file_path:e.file_path,done:!0,content:e.new_content}))},message:s,edit:a}):(0,r.jsx)("div",{className:"relative w-5/6 max-w-xs",children:(0,r.jsx)(tX,{edit:a,messageId:s.id})})};var tQ=s(94949),t0=s(24032);let t1=e=>{let{download:t}=(0,tQ.F)(),[s,r]=(0,a.useState)(void 0),{store:n,cacheImageUrl:i}=(0,l.mx)(),o=n.getState().imageUrlCache,d="".concat(e.dir_name,"/").concat(e.file_name),c=(0,a.useRef)(!1);return(0,a.useEffect)(()=>{c.current||(c.current=!0,(async()=>{if(o[d]){r(o[d]);return}let{url:s}=await t({dir_name:e.dir_name,file_name:e.file_name});r(s),i(d,s)})())},[t,e,d,o,i]),s},t2=e=>{var t;let{images:s,optimistImageUrls:a}=e,n=s.length+(null!==(t=null==a?void 0:a.length)&&void 0!==t?t:0)===1;return(0,r.jsxs)("div",{className:(0,i.cn)("mb-2 ml-auto flex max-w-[240px] flex-wrap justify-end gap-2 md:max-w-[240px]"),children:[null==a?void 0:a.map((e,t)=>(0,r.jsx)(t6,{imageUrl:e,singleImage:n},t)),s.map((e,t)=>(0,r.jsx)(t5,{image:e,singleImage:n},t))]})},t5=e=>{let{image:t,singleImage:s}=e,a=t1(t);return(0,r.jsx)(t6,{imageUrl:a,singleImage:s})},t6=e=>{let{imageUrl:t,singleImage:s}=e,{setSelectedImageUrl:n}=(0,l.mx)(),o=(0,t0.Eh)(e=>e.setImages),d=(0,t0.Eh)(e=>e.images),[c,u]=(0,a.useState)(!1),[m,p]=(0,a.useState)(!1),[h,g]=(0,a.useState)(!1),[f,v]=(0,a.useState)(!1),b=(0,N.Z)("md"),j=(0,a.useCallback)(()=>{t&&n(t)},[t,n]),y=(0,a.useCallback)(async e=>{if(e.stopPropagation(),t&&!c){v(!0),setTimeout(()=>v(!1),500);try{let e=await fetch(t),s=await e.blob();await navigator.clipboard.write([new ClipboardItem({[s.type]:s})]),u(!0),z.ZP.capture(R.SL.CHAT.IMAGE_COPIED,{image_type:s.type,image_size:s.size}),setTimeout(()=>{u(!1)},2e3)}catch(e){(0,ej.Eo)("Failed to copy image")}}},[t,c]),_=(0,a.useCallback)(async e=>{if(e.stopPropagation(),t&&!m){if(d.length>=10){eo.Am.error("Image limit reached",{description:"Please limit your message to ".concat(10," images.")});return}v(!0),setTimeout(()=>v(!1),500),p(!0);try{let e=await fetch(t),s=await e.blob(),r="image-".concat(Date.now(),".").concat(s.type.split("/")[1]||"png"),a=new File([s],r,{type:s.type}),n={url:URL.createObjectURL(a),name:r,uploading:!1,uploaded:!1,id:(0,ee.Z)()};o(e=>[...e,n]),g(!0),z.ZP.capture(R.SL.CHAT.IMAGE_ADDED_TO_INPUT,{image_type:s.type,image_size:s.size,current_image_count:d.length+1}),setTimeout(()=>{g(!1)},2e3)}catch(e){(0,ej.Eo)("Failed to add image to chat")}finally{p(!1)}}},[t,m,d.length,o]);return(0,r.jsx)("div",{className:"relative",children:(0,r.jsx)(w.z,{variant:"ghost",className:(0,i.cn)("relative inline-block p-0 hover:bg-transparent",{"h-[120px] w-[200px] md:h-[90px] md:w-[160px]":s,"h-24 w-24 md:h-16 md:w-16":!s}),type:"button",disabled:!t,onClick:j,children:t?(0,r.jsxs)("div",{className:"group/image-hover relative h-full w-full",children:[(0,r.jsx)("img",{loading:"lazy",src:t,alt:"chat image",className:"h-full w-full rounded-lg border object-cover"}),!b&&(0,r.jsxs)("div",{className:(0,i.cn)("pointer-events-none absolute inset-0 flex items-center justify-center gap-1 rounded-lg bg-black/50 opacity-0 transition-opacity duration-200",{"group-hover/image-hover:opacity-100":!f,"opacity-100":f}),children:[(0,r.jsx)(w.z,{variant:"secondary",size:"icon-sm",onClick:y,disabled:c,className:"pointer-events-auto h-6 w-6 bg-white/90 text-black hover:bg-white disabled:bg-white/90 disabled:text-black disabled:opacity-100",children:(0,r.jsx)(x.Z,{name:c?"check":"content_copy",className:"h-3 w-3"})}),(0,r.jsx)(w.z,{variant:"secondary",size:"icon-sm",onClick:_,disabled:m||h,className:"pointer-events-auto h-6 w-6 bg-white/90 text-black hover:bg-white disabled:bg-white/90 disabled:text-black disabled:opacity-100",children:(0,r.jsx)(x.Z,{name:h?"check":"add_photo_alternate",className:"h-3 w-3"})})]})]}):(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center rounded-lg border bg-background/80",children:(0,r.jsx)(x.Z,{name:"progress_activity",size:"small",className:"animate-spin"})})})})};var t4=s(5635),t7=s(74928);let t3=e=>{let{content:t,open:s,onOpenChange:a,openText:n,closedText:l}=e;return(0,r.jsxs)(t7.zF,{open:s,onOpenChange:a,className:"mt-4 max-w-[300px] overflow-hidden rounded-lg border border-muted-border",children:[(0,r.jsx)(t7.wy,{asChild:!0,children:(0,r.jsxs)(w.z,{variant:"secondary",className:(0,i.cn)("h-10 w-full justify-between pr-2 text-sm font-medium transition-all duration-200 ease-out",s&&"rounded-b-none"),children:[s?n:l,(0,r.jsx)(x.Z,{name:s?"unfold_less":"unfold_more",size:"small",className:"transition-transform duration-200 ease-out"})]})}),(0,r.jsx)(u.E.div,{initial:{height:0},animate:{height:s?"auto":0},exit:{height:0},transition:{type:"spring",bounce:0,duration:.4},style:{overflow:"hidden"},children:(0,r.jsx)("pre",{className:"rounded-b-md border-t border-muted-border bg-secondary p-4 py-2 text-sm",children:(0,r.jsx)("code",{className:"block max-h-[300px] overflow-x-auto overflow-y-auto whitespace-pre-wrap break-words",children:t})})})]})},t8=e=>{let{messageContent:t}=e,{error:s}=t9(t),[n,i]=(0,a.useState)(!1);return(0,r.jsx)(t3,{content:s,open:n,onOpenChange:i,openText:"Error",closedText:"Error"})};function t9(e){let t=e.match(/([\s\S]+)```([\s\S]+)```\n+$/);return t?{error:t[2].trim(),text:t[1].trim()}:(n.logging.error("no_error_message_found_in_input",{input:e}),{error:"",text:e})}let se=()=>(0,r.jsxs)("div",{className:"w-full rounded-lg border border-muted-border",children:[(0,r.jsxs)("div",{className:"flex h-10 w-full items-center justify-between rounded-b-none px-4 pr-2 text-sm font-medium",children:["Security Review",(0,r.jsx)(x.Z,{name:"security",size:"small"})]}),(0,r.jsx)("div",{className:"rounded-b-md border-t border-muted-border p-4 py-2 text-sm",children:(0,r.jsx)("span",{className:"text-muted-foreground",children:"Analyzing codebase for security vulnerabilities"})})]}),st=e=>{let{content:t}=e,[s,n]=(0,a.useState)(!1);return(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{children:"Write the code to create a new integration or update the existing integration with Supabase."}),(0,r.jsx)(t3,{content:t,open:s,onOpenChange:n,openText:"Hide detailed instructions",closedText:"Show detailed instructions"})]})},ss=e=>{let{content:t,selectedElements:s,containsError:a,tags:n,isSecurityReview:i}=e;return(0,r.jsxs)("div",{children:[(0,r.jsx)(sn,{selectedElements:s}),i?(0,r.jsx)(se,{}):(0,r.jsx)(si,{content:t,containsError:a}),(0,r.jsx)(sr,{content:t,tags:n})]})},sr=e=>{let{content:t,tags:s}=e;return s.includes("supabase-integration-update")?(0,r.jsx)(st,{content:t}):null},sa=e=>{let{elementType:t}=e,s=(0,t4.a)(t);return s?(0,r.jsx)(x.Z,{name:s,className:"size-4 text-black dark:text-white"}):null},sn=e=>{let{selectedElements:t}=e;return 0===t.length?null:(0,r.jsx)("div",{className:"mb-2 flex flex-wrap gap-2",children:t.map((e,t)=>{var s,a;return(0,r.jsxs)(D.u,{children:[(0,r.jsx)(D.aJ,{asChild:!0,children:(0,r.jsxs)("div",{className:(0,i.cn)((0,w.d)({variant:"outline",size:"sm"}),"flex items-center gap-2 text-xs"),children:[(0,r.jsx)(sa,{elementType:e.elementType}),(0,r.jsx)("span",{children:e.elementType})]})}),(0,r.jsxs)(D._v,{side:"top",children:["Line ",e.lineNumber," in ",null===(a=e.filePath)||void 0===a?void 0:null===(s=a.split)||void 0===s?void 0:s.call(a,"/").pop()]})]},t)})})},si=e=>{let{content:t,containsError:s}=e,{text:n,error:i}=(0,a.useMemo)(()=>s?t9(t):{text:t,error:null},[t,s]);return(0,r.jsxs)(r.Fragment,{children:[n,i&&(0,r.jsx)(t8,{messageContent:t})]})},sl=e=>{let{message:t}=e,{authUser:s}=(0,tF.Eu)(),a=(0,tZ.c)(e=>e.collaborators).find(e=>e.id===t.userId),n=(0,tU.hO)(e=>e.memberships).find(e=>e.user_id===t.userId),l=(null==a?void 0:a.id)===(null==s?void 0:s.uid)||(null==n?void 0:n.user_id)===(null==s?void 0:s.uid);return(0,r.jsxs)("div",{className:(0,i.cn)("flex flex-col",l?"items-end":"items-start pl-8"),children:[(0,r.jsx)(t2,{images:t.images,optimistImageUrls:t.optimistImageUrls}),(0,r.jsx)("div",{className:(0,i.cn)("overflow-wrap-anywhere overflow-auto whitespace-pre-wrap rounded-xl bg-transparent px-0 py-1.5 text-lg leading-[22px] md:text-base",{"max-w-[80%] bg-secondary px-3 py-3":l}),children:(0,r.jsx)(ss,{content:t.content,selectedElements:t.selectedElements,containsError:t.containsError,tags:t.tags,isSecurityReview:t.isSecurityReview})})]})},so=(0,a.memo)(e=>{let{messageId:t,previousMessageId:s,isLastMessage:o=!1,newMessageMinHeight:d,scrollToEdit:c}=e,u=(0,l.aK)(e=>e.messages[t]),m=(0,l.aK)(e=>e.sortedMessageIds).indexOf(t),p=(0,a.useMemo)(()=>(null==u?void 0:u.type)==="aiMessage"&&(1===m||m<2),[u,m]),h=(0,a.useMemo)(()=>{if(!u)return null;switch(u.type){case"userMessage":return(0,r.jsx)(sl,{message:u});case"userCommit":return(0,r.jsx)(tB,{message:u});case"aiMessage":return(0,r.jsx)(tm,{message:u,isFirstAIMessage:p});case"branchSwitched":return(0,r.jsx)(tp,{branchName:u.branchName});case"revertSuccess":return(0,r.jsx)(tG,{shortCommitHash:u.shortCommitHash,scrollToEdit:c});case"manualEdit":var e;return(0,r.jsxs)("div",{className:"ml-6",children:[(0,r.jsx)(t$,{message:u}),u.errors&&(0,r.jsx)(X,{errors:null!==(e=u.errors)&&void 0!==e?e:null})]});default:return n.logging.error("Unknown message role",{message:u}),null}},[u,p,c]);return u?(0,r.jsxs)("div",{className:(0,i.cn)("group flex flex-col pb-4 pr-2",{"pb-20":o&&"aiMessage"===u.type}),"data-message-id":u.id,"data-message-edit-id":sd(u),style:{minHeight:o&&d?d+"px":"auto"},children:[(0,r.jsx)(tW,{message:u,previousMessageId:s}),(0,r.jsx)("div",{className:(0,i.cn)({"pl-2":"userMessage"!==u.type,"pl-1 md:pl-0":"aiMessage"===u.type}),children:h})]}):null});so.displayName="ChatItem";let sd=e=>{if("aiMessage"===e.type)return e.editId}},46434:function(e,t,s){"use strict";s.d(t,{t:function(){return eM}});var r=s(57437),a=s(46214),n=s(2265),i=s(26438),l=s(62869),o=s(57346);let d="agent-mode-info-dismissed",c=()=>{try{let e=localStorage.getItem(d);if(!e)return!0;let t=parseInt(e,10);return Date.now()-t>=2592e5}catch(e){return!0}},u=()=>{try{localStorage.setItem(d,Date.now().toString())}catch(e){}},m=()=>{let{agentModeEnabled:e}=(0,i.v)(),[t,s]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{s(e&&c())},[e]),t)?(0,r.jsx)("div",{className:"relative flex w-full flex-col rounded-t-3xl border border-b-0 border-muted-border bg-background",children:(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2 pb-6 pl-4 pr-2 pt-2",children:[(0,r.jsx)("span",{className:"text-sm font-normal text-foreground",children:"Agent (Beta) costs adapt to task complexity"}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsxs)(l.z,{onClick:()=>{window.open("https://lovable.dev/blog/agent-mode-beta","_blank","noopener,noreferrer")},size:"sm",variant:"affirmative",children:["Read more",(0,r.jsx)(o.Z,{name:"arrow_outward",size:"small"})]}),(0,r.jsx)("button",{type:"button",className:"group flex h-7 w-7 items-center justify-center hover:bg-transparent",onClick:()=>{s(!1),u()},children:(0,r.jsx)(o.Z,{name:"close",size:"small",className:"text-muted-foreground"})})]})]})}):null};var p=s(74026),h=s(20653),g=s(38706),x=s(25658),f=s(55157),v=s(23590),b=s(55721),j=s(35354),y=s(2043),_=s(49284),w=s(94508),N=s(62380);let E=e=>{let{onFileUpload:t}=e,s=(0,g.T_)("ChatInputActionMenu"),[i,l]=(0,n.useState)(!1),{isMac:d}=(0,j.Z)(),{openSettings:c}=(0,f.r)(),{canEdit:u}=(0,y.t)(),m=(0,v.G)(),p=(0,x.z)(e=>e.showHistory),{setShowHistory:E}=(0,x.VF)();return(0,r.jsxs)(b.h_,{open:i,onOpenChange:l,children:[(0,r.jsx)(b.$F,{asChild:!0,children:(0,r.jsx)("button",{className:(0,w.cn)("flex size-6 items-center justify-center rounded-full border border-muted-border text-muted-foreground outline-none duration-150 ease-out","shrink-0 transition-colors hover:bg-muted-hover",i&&"bg-muted-active"),children:(0,r.jsx)(o.Z,{name:"add",size:"small",className:(0,w.cn)("transition-transform",i&&"rotate-[135deg]")})})}),(0,r.jsxs)(b.AW,{align:"start",className:"min-w-[240px]",children:[m&&(0,r.jsxs)(b.Xi,{onClick:()=>c("github"),children:[(0,r.jsx)(h.wGg,{}),(0,r.jsx)("p",{children:"GitHub"})]}),(0,r.jsxs)(b.Xi,{onClick:()=>{p||a.ZP.capture(_.SL.TABS.HISTORY_OPENED),E(e=>!e)},children:[(0,r.jsx)(o.Z,{name:"history_2"}),(0,r.jsx)("p",{children:s("history")})]}),u&&(0,r.jsxs)(b.Xi,{onClick:()=>c("knowledge"),children:[(0,r.jsx)(o.Z,{name:"school"}),(0,r.jsx)("p",{children:s("knowledge")})]}),u&&(0,r.jsxs)(b.Xi,{onClick:()=>c("project"),children:[(0,r.jsx)(o.Z,{name:"settings"}),(0,r.jsx)("p",{children:s("projectSettings")}),d?(0,r.jsx)(b.KM,{className:"hidden sm:flex",children:"⌘."}):(0,r.jsx)(b.KM,{className:"hidden sm:flex",children:"Ctrl."})]}),m&&(0,r.jsxs)(b.Xi,{onClick:()=>c("supabase"),children:[(0,r.jsx)(N.Z,{className:"h-4 w-auto",viewBox:"0 0 109 113"}),(0,r.jsx)("p",{children:"Supabase"})]}),(0,r.jsx)(b.VD,{}),(0,r.jsxs)(b.Xi,{onClick:t,children:[(0,r.jsx)(o.Z,{name:"add_photo_alternate"}),(0,r.jsx)("p",{children:s("attach")})]})]})]})};var C=s(93681),S=s(97752),k=s(48614),I=s(1188),A=s(50273),P=s(27410),M=s(5635);let T=e=>{let{elementType:t}=e,s=(0,M.a)(t);return s?(0,r.jsx)(o.Z,{name:s,fill:"white",className:"size-4"}):null},D=(0,n.memo)(()=>{let e=(0,A.UC)(e=>e.selectedElements),{removeSelectedElement:t}=(0,A.S9)(),s=e=>{var t,s;return"Line ".concat(e.lineNumber," in ").concat(null===(s=e.filePath)||void 0===s?void 0:null===(t=s.split)||void 0===t?void 0:t.call(s,"/").pop())},[a,i]=(0,n.useState)(null),l=(0,n.useCallback)(()=>{a&&t(a)},[a,t]);return(null==e?void 0:e.length)?(0,r.jsx)("div",{className:"bg-transparent",children:(0,r.jsx)("ul",{className:"flex flex-wrap gap-2",children:(0,r.jsx)(k.M,{mode:"popLayout",children:e.map(e=>(0,r.jsx)(I.E.li,{initial:{opacity:0,scale:.6},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.6,transition:{duration:.15}},transition:{duration:.1,ease:[.5,1,.89,1],opacity:{duration:.1}},layoutId:"".concat(e.filePath,"-").concat(e.lineNumber),children:(0,r.jsx)(P.Z,{label:s(e),side:"top",children:(0,r.jsxs)("button",{className:"flex h-full w-full cursor-pointer items-center gap-0.5 rounded-md p-1 pr-2 hover:bg-background",onMouseEnter:()=>i(e),onMouseLeave:()=>i(null),onClick:l,children:[(0,r.jsx)(k.M,{mode:"wait",children:(0,r.jsx)(I.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"flex-shrink-0",children:a!==e?(0,r.jsx)(T,{elementType:e.elementType}):(0,r.jsx)(o.Z,{name:"close",size:"small"})},a===e?"close":"element")}),(0,r.jsx)("span",{className:"flex-grow select-none truncate text-left text-xs",children:"".concat(e.elementType)})]})})},"".concat(e.filePath,"-").concat(e.lineNumber)))})})}):null});D.displayName="ChatInputSelectElementsRow",(0,n.memo)(e=>{var t,s;let{element:a,onRemoveElement:i}=e,[l,d]=(0,n.useState)(!1);return(0,r.jsx)(P.Z,{label:"Line ".concat(a.lineNumber," in ").concat(null===(s=a.filePath)||void 0===s?void 0:null===(t=s.split)||void 0===t?void 0:t.call(s,"/").pop()),side:"top",children:(0,r.jsxs)("button",{onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),className:"group/select-element flex h-full w-full cursor-pointer items-center gap-0.5 rounded-md p-1 pr-2 hover:bg-background",onClick:()=>i(a),children:[(0,r.jsx)(k.M,{mode:"wait",children:(0,r.jsx)(I.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"flex-shrink-0",children:l?(0,r.jsx)(o.Z,{name:"close",size:"small"}):(0,r.jsx)(T,{elementType:a.elementType})},l?"close":"element")}),(0,r.jsx)("span",{className:"flex-grow select-none truncate text-left text-xs",children:"".concat(a.elementType)})]})})}).displayName="ChatInputSelectElement";var R=s(71830),L=s(61160),z=s(74746),O=s(90045),F=s(57054),Z=s(81103);let U="chat-mode-nudge-last-shown",H=()=>{try{let e=localStorage.getItem(U);if(!e)return!0;let t=parseInt(e,10);return Date.now()-t>=12096e5}catch(e){return!0}},V=()=>{try{localStorage.setItem(U,Date.now().toString())}catch(e){}},W=e=>{let{projectId:t}=e,s=(0,g.T_)("ChatModeToggle"),{isAgentModeDefault:d}=(0,i.v)(),c=(0,O.hT)(e=>e.chatMode===O.jE.CHAT_ONLY),{setChatMode:u}=(0,O.VK)(),m=(0,z.iY)(),[p,h]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{h(!!(null==m?void 0:m.isStuck)&&!c&&!(null==m?void 0:m.chatOnly)&&H())},[m,c]),(0,r.jsxs)(F.J2,{open:p,children:[(0,r.jsx)(F.xo,{asChild:!0,children:(0,r.jsx)("div",{children:(0,r.jsxs)(Z.u,{children:[(0,r.jsx)(Z.aJ,{asChild:!0,children:(0,r.jsxs)(l.z,{type:"button",variant:"outline",size:"sm",onClick:()=>{a.ZP.capture("chat_mode_toggled",{state:c,project_id:t,stuck_popover_shown:p}),h(!1),p&&V(),c&&V(),u(c?d?O.jE.AGENT:O.jE.DEFAULT:O.jE.CHAT_ONLY)},className:(0,w.cn)("flex h-6 gap-1 rounded-full border py-0 pl-1.5 pr-2.5 font-normal text-muted-foreground hover:border-border hover:bg-transparent md:hover:bg-accent md:hover:text-muted-foreground",{"border-affirmative-primary bg-affirmative-primary text-affirmative-primary-foreground hover:border-affirmative-primary hover:bg-affirmative-primary hover:text-affirmative-primary-foreground md:hover:bg-affirmative-primary/90 md:hover:text-affirmative-primary-foreground":c}),children:[(0,r.jsx)(o.Z,{name:"emoji_objects",size:"small"}),s("chat")]})}),(0,r.jsx)(Z._v,{className:"hidden max-w-[35ch] md:flex",children:(0,r.jsx)("p",{children:s("chatTooltip")})})]})})}),(0,r.jsxs)(F.yk,{children:[(0,r.jsxs)("div",{className:"flex w-full items-center justify-between",children:[(0,r.jsx)("p",{className:"font-medium text-popover-foreground",children:s("feelingStuck")}),(0,r.jsx)(o.Z,{name:"close",className:"cursor-pointer text-muted-foreground",onClick:()=>{h(!1),u(O.jE.DEFAULT),V(),a.ZP.capture("stuck_popover_dismissed",{project_id:t,message_id:null==m?void 0:m.id})}})]}),(0,r.jsx)("p",{className:"text-muted-foreground",children:s("useChatMode")})]})]})};var K=s(29991),q=s(33145),G=s(27648),B=s(3813),Y=s(5073);let J="legacy-mode-nudge-last-shown",X=[{icon:"code",title:"Smarter Code Edits",description:"90% fewer errors and improved generations."},{icon:"devices",title:"New Capabilities",description:"Web search, image generation and more"},{icon:"trending_up",title:"Adaptive Pricing",description:"Pay based on actions, not messages."}],$=()=>{try{let e=localStorage.getItem(J);if(!e)return!0;let t=parseInt(e,10);return Date.now()-t>=864e5}catch(e){return!0}},Q=()=>{try{localStorage.setItem(J,Date.now().toString())}catch(e){}},ee=e=>{let{projectId:t}=e,s=(0,B.zq)(),{agentModeEnabled:d,setAgentMode:c}=(0,i.v)(),u=(0,O.hT)(e=>e.chatMode)===O.jE.CHAT_ONLY,[m,p]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{p(!d&&$())},[d]),s&&!u&&m)?(0,r.jsx)("div",{className:"relative flex w-full flex-col rounded-t-3xl border border-b-0 border-muted-border bg-background",children:(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2 pb-6 pl-4 pr-2 pt-2",children:[(0,r.jsxs)(Y.zs,{children:[(0,r.jsxs)(Y.Yi,{className:"flex cursor-pointer items-center gap-1",children:[(0,r.jsx)("span",{className:"text-sm font-normal text-foreground",children:"Agent mode produces 90% less errors"}),(0,r.jsx)(o.Z,{name:"info",size:"small",className:"text-muted-foreground"})]}),(0,r.jsxs)(Y.bZ,{className:"ml-2 flex w-[560px] max-w-[60vw] gap-0 rounded-2xl p-0",side:"top",sideOffset:20,children:[(0,r.jsx)("div",{className:"relative m-3 hidden w-1/3 md:block",children:(0,r.jsx)(q.default,{src:"/img/announcements/agent-release.png",alt:"Meet Agent Mode",fill:!0,className:"rounded-lg object-cover"})}),(0,r.jsxs)("div",{className:"flex w-2/3 flex-1 flex-col gap-3 p-4 pl-2",children:[(0,r.jsx)("p",{className:"w-full text-2xl font-medium text-card-foreground",children:"Meet Agent Mode (Beta)"}),(0,r.jsx)("p",{className:"w-full text-base text-muted-foreground",children:"Here is what's new:"}),(0,r.jsx)("div",{className:"flex flex-col gap-4",children:X.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"mt-0.5 flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-lg bg-secondary",children:(0,r.jsx)(o.Z,{name:e.icon,size:"small",className:"text-secondary-foreground"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-sm font-medium leading-tight text-card-foreground",children:e.title}),(0,r.jsx)("p",{className:"text-sm leading-tight text-muted-foreground",children:e.description})]})]},e.title))}),(0,r.jsx)(l.z,{variant:"secondary",size:"sm",asChild:!0,className:"ml-11 mt-1 w-fit",children:(0,r.jsxs)(G.default,{href:"https://lovable.dev/blog/agent-mode-beta",target:"_blank",rel:"noopener noreferrer",children:["Read more ",(0,r.jsx)(o.Z,{name:"arrow_outward"})]})})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(l.z,{onClick:()=>{c(!0),p(!1),Q(),a.ZP.capture("legacy_mode_nudge_activated",{project_id:t})},size:"sm",variant:"affirmative",children:"Try Now"}),(0,r.jsx)("button",{type:"button",className:"group flex h-7 w-7 items-center justify-center hover:bg-transparent",onClick:()=>{p(!1),Q(),a.ZP.capture("legacy_mode_nudge_dismissed",{project_id:t})},children:(0,r.jsx)(o.Z,{name:"close",size:"small",className:"text-muted-foreground"})})]})]})}):null};var et=s(27466),es=s(96279),er=s(65666);let ea=e=>{let{className:t,disabled:s=!1,isSendingDisabled:a=!1}=e,i=(0,er.v)(),{showStopAction:l,mutation:d}=(0,es.q)({projectId:null!=i?i:void 0}),c=(0,n.useCallback)(async()=>{await d.mutateAsync()},[d]);return i&&(l||d.isPending)?(0,r.jsx)("button",{type:"button",className:(0,w.cn)("flex size-6 items-center justify-center rounded-full bg-foreground text-background transition-opacity duration-150 ease-out disabled:cursor-not-allowed disabled:opacity-50",t),disabled:d.isPending,onClick:c,children:(0,r.jsx)(o.Z,{name:"stop_fill",size:"small"})}):(0,r.jsx)("button",{id:"chatinput-send-message-button",type:"submit",className:(0,w.cn)("flex size-6 items-center justify-center rounded-full bg-foreground text-background transition-opacity duration-150 ease-out disabled:cursor-not-allowed disabled:opacity-50",t),disabled:a||s,children:(0,r.jsx)(o.Z,{name:"arrow_upward_alt_600",size:"default"})})};var en=s(27132),ei=s(16054),el=function(){let e=navigator.userAgent.toLowerCase();return/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(e)},eo=s(6273),ed=s(60256);let ec=new eo.XMLParser({ignoreAttributes:!1,preserveOrder:!0,trimValues:!0}),eu=()=>{let[e,t]=(0,n.useState)([]),[s,r]=(0,n.useState)(!1),a=(0,n.useRef)(void 0),i=(0,n.useRef)(void 0),{userData:l}=(0,ed.SE)(),o=(0,z.$m)(),d=null==o?void 0:o.messageId,c=null==o?void 0:o.message,u=(0,n.useCallback)(e=>{let t="<lov-actions>",s=e.indexOf(t),r=e.indexOf("</lov-actions>",s);if(-1===s||-1===r)return[];let a=e.substring(s+t.length,r);try{let e=ec.parse(a),t=[];return Array.isArray(e)&&e.forEach(e=>{if(e["lov-suggestion"]){var s,r;let a=e["lov-suggestion"],n=null===(s=e[":@"])||void 0===s?void 0:s["@_message"],i=Array.isArray(a)?null===(r=a[0])||void 0===r?void 0:r["#text"]:null==a?void 0:a["#text"];n&&i&&t.push({title:i.trim(),message:n.trim()})}}),t}catch(e){return console.error("Error parsing lov-actions XML:",e),[]}},[]),m=(0,n.useMemo)(()=>c&&"aiMessage"===c.type?u(c.content):[],[c,u]),p=m.length>0;return(0,n.useEffect)(()=>{d&&d!==a.current&&(a.current=d,r(!1),i.current=void 0)},[d]),(0,n.useEffect)(()=>{let e=(null==l?void 0:l.suggestions_enabled)===!0;if(!e){r(!1);return}p&&c&&d&&d!==i.current&&c.persisted&&e&&(t(m),r(!0),i.current=d)},[p,d,c,m,null==l?void 0:l.suggestions_enabled]),{suggestions:e,isVisible:s,hideSuggestions:(0,n.useCallback)(()=>{r(!1)},[])}};var em=s(63420),ep=s(41135),eh=s(6809),eg=s(57492),ex=s(24032);let ef=e=>{let{projectId:t}=e,{store:s}=(0,ex.WR)(),a=s(e=>e.message),[i,d]=(0,n.useState)([]),[c,u]=(0,n.useState)(!1),{openSettings:m}=(0,f.r)(),p=(0,eh.N)(),h=!!p;return((0,n.useEffect)(()=>{if(a){let e=(0,eg.su)(a);d(e),e.length>0&&u(!1)}else d([])},[a]),0===i.length||c)?null:(0,r.jsx)("div",{className:"relative flex w-full flex-col rounded-t-lg border border-b-0 border-orange-500/50 bg-orange-500/10",children:(0,r.jsxs)("div",{className:"flex items-start justify-between gap-2 py-2 pb-4 pl-3 pr-2",children:[(0,r.jsxs)("div",{className:"flex flex-1 items-start gap-2",children:[(0,r.jsx)(o.Z,{name:"info",className:"mt-0.5 text-base text-orange-500","aria-label":"Warning"}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("span",{className:"text-sm font-medium text-foreground",children:"Sensitive API key detected"}),(0,r.jsxs)("span",{className:"text-sm text-muted-foreground",children:[h?"API keys detected. Ask Lovable to store these as secrets instead of pasting them in messages.":"API keys detected in your message. Connect Supabase first, then ask Lovable to store them securely instead.",(0,r.jsxs)("div",{className:"my-2",children:[!h&&(0,r.jsxs)(l.z,{variant:"outline",size:"sm",onClick:()=>{m("supabase")},children:[(0,r.jsx)(ep.xR.Supabase,{className:"h-4 w-4"}),"Connect Supabase"]}),p&&(0,r.jsx)(l.z,{variant:"outline",size:"sm",asChild:!0,children:(0,r.jsxs)("a",{href:"https://supabase.com/dashboard/project/".concat(p.id,"/settings/functions"),target:"_blank",rel:"noreferrer",children:[(0,r.jsx)(o.Z,{name:"key",className:"h-4 w-4 text-xs"}),(0,r.jsx)("span",{className:"text-xs",children:"Manage Secrets"}),(0,r.jsx)(o.Z,{name:"arrow_outward",className:"h-4 w-4 text-xs text-muted-foreground"})]})}),(0,r.jsx)(l.z,{variant:"link",size:"sm",asChild:!0,children:(0,r.jsxs)("a",{href:"https://docs.lovable.dev/features/security",target:"_blank",rel:"noreferrer",children:[(0,r.jsx)(o.Z,{name:"help",className:"h-4 w-4 text-muted-foreground"}),(0,r.jsx)("span",{className:"text-xs text-muted-foreground",children:"Learn more about security"}),(0,r.jsx)(o.Z,{name:"arrow_outward",className:"h-4 w-4 text-muted-foreground"})]})})]})]})]})]}),(0,r.jsx)("button",{type:"button",className:"group flex h-7 w-7 items-center justify-center hover:bg-transparent",onClick:()=>{u(!0)},children:(0,r.jsx)(o.Z,{name:"close",className:"h-3 w-3 text-muted-foreground group-hover:opacity-50"})})]})})};var ev=s(72380),eb=s(71759),ej=s(32129),ey=s(30438),e_=s(59053),ew=s(79358),eN=s(47902);let eE=()=>{var e;let{userData:t}=(0,ed.SE)(),{dailyCreditLimit:s,dailyCreditsUsed:i,bonusCredits:l}=(0,e_.O)(),d=(0,eb.hO)(e=>e.projectWorkspace),[c,u]=(0,n.useState)(!0),m=(0,ev.v)(),p=(0,ey.c)(),h=null==t?void 0:null===(e=t.tips)||void 0===e?void 0:e.upgrade_dialog_dismissed_at,g=(null!=s?s:0)-(null!=i?i:0)+(null!=l?l:0);return((0,n.useEffect)(()=>{h&&!(0,eN.ZK)(h)&&u(!1)},[h]),p&&(null==d?void 0:d.plan)==="free"&&!(g>2)&&c)?(0,r.jsx)("div",{className:"relative flex w-full flex-col rounded-t-3xl border border-b-0 border-muted-border bg-background",children:(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2 pb-6 pl-4 pr-2 pt-2",children:[(0,r.jsx)("div",{className:"flex items-center gap-1",children:(0,r.jsxs)("span",{className:"text-sm font-normal text-foreground",children:[(0,ew.H)(g)," free ",1===g?"credit":"credits"," ","remaining today"]})}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(ej.Z,{plan:null==d?void 0:d.plan,onClick:()=>{a.ZP.capture(_.VL.UPGRADE.BUTTON_CLICKED.CHAT,{context:_.VL.UPGRADE.CONTEXT.OUT_OF_CREDITS,remaining_credits:g})},children:"Upgrade Now"}),(0,r.jsx)("button",{type:"button",className:"group flex h-7 w-7 items-center justify-center hover:bg-transparent",onClick:()=>{m.mutate({upgrade_dialog_dismissed_at:new Date().toISOString()}),u(!1)},children:(0,r.jsx)(o.Z,{name:"close",size:"small",className:"text-muted-foreground"})})]})]})}):null};var eC=s(87751);let eS=e=>{let{suggestions:t,isVisible:s=!0}=e,{store:a}=(0,ex.WR)(),i=a(e=>e.setMessage),o=e=>{i(e.message)},[d,c]=(0,n.useState)(!0),[u,m]=(0,n.useState)(!1),p=(0,n.useRef)(null);return((0,n.useEffect)(()=>{let e=p.current;if(!e||!s){c(!0),m(!1);return}e.scrollLeft=0;let t=()=>{c(0===e.scrollLeft),m(e.scrollLeft+e.clientWidth>=e.scrollWidth-1)};return t(),e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)},[t,s]),s&&t.length)?(0,r.jsx)("div",{children:(0,r.jsxs)("div",{className:"relative w-full rounded-t-lg bg-background py-2 pb-2",children:[(0,r.jsx)("div",{ref:p,className:"flex w-full flex-nowrap gap-2 overflow-x-auto px-3 pb-1 scrollbar-hide",children:t.map(e=>(0,r.jsx)(l.z,{className:"h-7 whitespace-nowrap rounded-lg bg-muted px-3 text-sm font-normal text-foreground hover:bg-muted/80 focus:outline-none",type:"button",onClick:()=>o(e),children:e.title},e.message))}),!u&&(0,r.jsx)("div",{className:"pointer-events-none absolute right-0 top-0 h-full w-24 bg-gradient-to-l from-background to-background/0"}),!d&&(0,r.jsx)("div",{className:"pointer-events-none absolute left-0 top-0 h-full w-24 bg-gradient-to-r from-background to-background/0"})]})}):null};var ek=s(21399),eI=s(50126),eA=s(29328);let eP=()=>{let e=(0,er.v)(),t=(0,A.UC)(e=>e.isVisualEditingActive),{setIsVisualEditorPanelOpen:s,turnOffVisualEditing:n}=(0,A.S9)(),{startLiveMode:i}=(0,eA.My)(),{hasUnsavedChanges:d}=(0,em.v)(),c=(0,eI.Sl)(e=>e.activeView),u=t&&d,m="dev-mode"===c,{isMac:p}=(0,j.Z)(),h=u||m&&!t;return(0,r.jsxs)(Z.u,{instant:u,children:[(0,r.jsx)(Z.aJ,{className:"flex py-0",type:"button",asChild:!0,children:(0,r.jsxs)(l.z,{id:"visual-editor-toggle",type:"button",variant:"outline",size:"sm",onClick:t?()=>{n(),a.LJ.capture("visual_editor_toggled",{state:!t,project_id:e})}:()=>{s(!0),i(),a.LJ.capture("visual_editor_toggled",{state:t,project_id:e})},disabled:h,className:(0,w.cn)("flex h-6 gap-1 rounded-full border py-0 pl-1.5 pr-2.5 font-normal text-muted-foreground hover:border-border hover:bg-transparent md:hover:bg-accent md:hover:text-muted-foreground",{"border-affirmative-primary bg-affirmative-primary text-affirmative-primary-foreground hover:border-affirmative-primary hover:bg-affirmative-primary hover:text-affirmative-primary-foreground md:hover:bg-affirmative-primary/90 md:hover:text-affirmative-primary-foreground":t}),children:[(0,r.jsx)(o.Z,{name:"visual_edits",size:"small"}),"Edit"]})}),(0,r.jsx)(Z._v,{children:(0,r.jsx)("p",{children:m&&!t?"Exit code mode to use visual editor":u?"Save or discard to exit":"Select to edit (".concat(p?"⌥S":"Ctrl+S",")")})})]})},eM=e=>{let{chatPanelRef:t,children:s}=e,a=(0,x.z)(e=>e.showHistory);return(0,en.Z)("md")?s:a?null:(0,r.jsx)(eD,{chatPanelRef:t})},eT=e=>e.charAt(0).toUpperCase()+e.slice(1),eD=(0,n.memo)(e=>{let{chatPanelRef:t}=e,s=(0,B.zq)(),l=(0,B.Zp)(),o=(0,B.aI)(),{isAgentModeDefault:d}=(0,i.v)(),{setSelectedImageUrl:c}=(0,z.mx)(),{hasUnsavedChanges:u}=(0,em.v)(),h=(0,er.v)(),g=(0,A.UC)(e=>e.isVisualEditingActive),{setChatMode:x}=(0,O.VK)(),{message:f,sendChatMessage:v,isSendingDisabled:b,AuthDialogComponent:j}=(0,ek.i)(),{dropzoneElement:y,openFileUpload:w,getInputProps:N}=(0,ei.j)({portalTargetRef:t}),k=g&&u,I=(0,A.UC)(e=>{var t;return null===(t=e.selectedElements)||void 0===t?void 0:t[0]}),P=el(),[M,T]=(0,n.useState)(!1),{suggestions:F,isVisible:U,hideSuggestions:H}=eu(),V=(0,n.useCallback)(async()=>{if(H(),(0,eg.Go)(f)){a.ZP.capture(_.SL.CHAT.API_KEY_DETECTED,{project_id:h}),T(!0);return}await v()},[h,v,f,H]);return(0,r.jsxs)("div",{className:"flex max-h-[calc(100%-37px)] shrink-0 flex-col overflow-visible",children:[(0,r.jsx)(eC.s,{isOpen:M,onDismiss:()=>T(!1),onConfirm:()=>{T(!1),v(),a.ZP.capture(_.SL.CHAT.API_KEY_WARNING_DISMISSED,{project_id:h})}}),o&&(0,r.jsx)(eS,{suggestions:F,isVisible:U}),(0,r.jsx)("div",{className:"relative top-4 space-y-4",children:!P&&(0,r.jsxs)(r.Fragment,{children:[h&&(0,r.jsx)(ef,{projectId:h}),(0,r.jsx)(eE,{}),h&&s&&(0,r.jsx)(ee,{projectId:h}),h&&s&&(0,r.jsx)(m,{})]})}),(0,r.jsxs)(p.x,{className:"relative mr-2 md:mr-0",onSubmit:V,AuthDialogComponent:j,children:[(0,r.jsx)(S.T,{setSelectedImageUrl:c}),!g&&(0,r.jsx)(D,{}),(0,r.jsxs)(Z.u,{children:[(0,r.jsx)(Z.aJ,{asChild:!0,children:(0,r.jsx)("div",{children:(0,r.jsx)(R.E,{autoSize:!0,minHeight:40,className:"m-1 rounded-md p-0",disabled:k,forceShowPlaceholder:!1,placeholder:I?"Ask Lovable to modify ".concat(eT(I.elementType),"..."):"Ask Lovable...",enableSlashCommands:!1,isChatModeActive:!1,onEnableChatMode:()=>x(O.jE.CHAT_ONLY),onDisableChatMode:()=>x(d?O.jE.AGENT:O.jE.DEFAULT)})})}),(0,r.jsx)(Z._v,{hidden:!g||!u,children:(0,r.jsx)("p",{children:"Save to continue"})})]}),(0,r.jsx)(L.y,{}),(0,r.jsxs)(C.s,{children:[(0,r.jsx)("input",{id:"file-upload",className:"hidden",...N()}),y,(0,r.jsx)(E,{onFileUpload:w}),!P&&(0,r.jsx)(eP,{}),(0,r.jsxs)("div",{className:"ml-auto flex items-center gap-1",children:[h&&(0,r.jsx)(W,{projectId:h}),(0,r.jsxs)("div",{className:"ml-1 flex items-center gap-2",children:[(0,r.jsx)(K.r,{}),l&&h?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(et.O,{projectId:h}),(0,r.jsx)(ea,{disabled:k,isSendingDisabled:b})]}):(0,r.jsx)(ea,{disabled:k,isSendingDisabled:b})]})]})]})]}),(0,r.jsx)("div",{className:"z-10 h-2 w-full bg-background"})]})});eD.displayName="ChatInputV2NormalContent"},66431:function(e,t,s){"use strict";s.d(t,{A:function(){return p}});var r=s(57437),a=s(27648),n=s(2265),i=s(62869),l=s(78276),o=s(26110),d=s(57346),c=s(26237),u=s(79396),m=s(37675);let p=()=>{let e=(0,c.C)(),{mutate:t,isPending:s}=(0,u.I)({skipSafetyCheck:!0}),p=(0,m.bk)(e=>e.editIdToConfirmRestoreFor),{setEditIdToConfirmRestoreFor:h}=(0,m.Xr)(),{disabled:g,disabledReason:x}=(0,n.useMemo)(()=>s?{disabled:!0,disabledReason:"Restore is in progress"}:e?{disabled:!0,disabledReason:(0,r.jsx)("p",{className:"max-w-sm",children:"Cannot transfer project while there is an active operation in progress (e.g. chat or revert). Please wait for the operation to complete.,"})}:{disabled:!1,disabledReason:null},[e,s]);return(0,r.jsx)(o.Vq,{open:!!p,onOpenChange:e=>!e&&h(void 0),children:(0,r.jsxs)(o.cZ,{children:[(0,r.jsx)(o.fK,{children:(0,r.jsx)(o.$N,{children:"Can’t revert database changes"})}),(0,r.jsx)(o.Be,{children:"The database was modified since this version. Lovable can’t revert database changes automatically. You’ll need to update the database manually."}),(0,r.jsxs)(o.cN,{children:[(0,r.jsx)(i.z,{variant:"outline",children:(0,r.jsxs)(a.default,{href:"https://docs.lovable.dev/integrations/supabase",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 overflow-hidden text-ellipsis whitespace-nowrap",children:[(0,r.jsx)("span",{className:"truncate",children:"Learn more"}),(0,r.jsx)(d.Z,{name:"arrow_outward"})]})}),(0,r.jsx)(l.b,{showTooltip:g,tooltipContent:x,children:(0,r.jsx)(o.GG,{asChild:!0,children:(0,r.jsxs)(i.z,{variant:"affirmative",onClick:()=>t({edit:{id:p}}),disabled:g,children:["Proceed Anyway",s&&(0,r.jsx)(d.Z,{className:"ml-1 animate-spin",name:"progress_activity",size:"small"})]})})})]})]})})}},87418:function(e,t,s){"use strict";s.d(t,{W:function(){return a}});var r=s(2265);let a=e=>{let{listRef:t,containerRef:s}=e,[a,n]=(0,r.useState)(!1),[i,l]=(0,r.useState)(!1),[o,d]=(0,r.useState)(!1),c=(0,r.useCallback)(()=>setTimeout(()=>{if(!t.current)return;let e=t.current.scrollSize-t.current.viewportSize-t.current.scrollOffset<84,s=t.current.scrollOffset<84,r=t.current.scrollSize>t.current.viewportSize;l(e),d(s),n(r)},0),[t]),u=(0,r.useCallback)(()=>{t.current&&t.current.scrollTo(t.current.scrollSize)},[t]);return(0,r.useEffect)(()=>{let e=s.current;if(!e)return;let t=new MutationObserver(c);t.observe(e,{childList:!0,subtree:!0});let r=new ResizeObserver(c);return r.observe(e),c(),()=>{t.disconnect(),r.disconnect()}},[s,c]),{isScrollable:a,isScrolledToEnd:i,isScrolledToStart:o,checkScrollPosition:c,scrollToEnd:u}}},21399:function(e,t,s){"use strict";s.d(t,{i:function(){return v}});var r=s(57437),a=s(2265),n=s(26438),i=s(52558),l=s(10867),o=s(90045),d=s(52055),c=s(84350),u=s(61160),m=s(24032),p=s(95033),h=s(29328),g=s(77113),x=s(50273),f=s(47902);let v=()=>{let{closeVisualEditsPanel:e}=(0,x.S9)(),{agentModeEnabled:t}=(0,n.v)(),{sendChatMessage:s,hasActiveLock:v}=(0,c.O)(),{clearEditorState:b,restoreEditorState:j}=(0,m.WR)(),y=(0,g.iZ)(e=>e.project),{authUser:_}=(0,i.Eu)(),[w,N]=(0,a.useState)(!1),[E,C]=(0,a.useState)(!1),[S,k]=(0,a.useState)(()=>(0,f.Y)()),I=(0,m.Eh)(e=>e.images);(0,m.Eh)(e=>e.setImages);let A=(0,m.Eh)(e=>e.message),P=(0,x.UC)(e=>e.selectedElements),{setSelectedElements:M}=(0,x.S9)(),T=(0,o.hT)(e=>e.chatMode),{setChatMode:D}=(0,o.VK)(),{startLiveMode:R}=(0,h.My)();(0,a.useEffect)(()=>{let e=setInterval(()=>{k((0,f.Y)())},1e3);return()=>clearInterval(e)},[]),(0,a.useEffect)(()=>{let e=()=>{k((0,f.Y)())};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[]);let L=(0,a.useMemo)(()=>I.some(e=>e.uploading),[I]),z=(0,a.useMemo)(()=>v||E||!y,[v,E,y]),O=(0,a.useMemo)(()=>z||0===A.length||L||(0,u.L)(A)||S.isRateLimited,[z,A,L,S.isRateLimited]),{isAgentModeDefault:F}=(0,n.v)(),Z=(0,a.useCallback)(async()=>{if(O)return;if(S.isRateLimited){console.warn("Cannot send message: rate limited");return}if(T===o.jE.CHAT_ONLY&&A.toLowerCase().includes("lov-action")&&D(F?o.jE.AGENT:o.jE.DEFAULT),!_){N(!0);return}let r={selectedElements:P};C(!0),R();try{e(),await s({body:{id:(0,l.Fd)(),message:A,images:I.map(e=>({image_id:e.id,type:p.V.USER_UPLOAD})),selected_elements:P,optimisticImageUrls:I.map(e=>e.url),chat_only:T===o.jE.CHAT_ONLY,agent_mode:t?"enabled":"disabled"},options:{clear:()=>{b(),M([])},restore:()=>{j(),M(r.selectedElements)}}})}finally{C(!1)}},[O,S.isRateLimited,T,A,_,I,P,R,D,e,s,b,M,j,t]);return{message:A,sendChatMessage:Z,isSendingDisabled:O,isLocked:z,isSubmitting:E,isRateLimited:S.isRateLimited,rateLimitSecondsRemaining:S.secondsRemaining,AuthDialogComponent:(0,r.jsx)(d.o,{open:w,onOpenChange:N})}}},96279:function(e,t,s){"use strict";s.d(t,{q:function(){return u}});var r=s(21770),a=s(2265),n=s(14438),i=s(49131),l=s(26237),o=s(3097),d=s(74746),c=s(92441);function u(e){let{projectId:t}=e,s=(0,i.SJ)(),u=(0,o.b)(),[m,p]=(0,a.useState)(void 0),{addStoppedMessageId:h,setLatestStreamedMessage:g,updateMessage:x}=(0,d.mx)(),f=(0,d.aK)(e=>e.sortedMessageIds),v=(0,d.aK)(e=>e.messages),b=(0,a.useMemo)(()=>null==f?void 0:f.findLast(e=>{var t;return(null===(t=v[e])||void 0===t?void 0:t.type)==="userMessage"}),[f,v]),j=(0,a.useMemo)(()=>null==f?void 0:f.findLast(e=>{var t;return(null===(t=v[e])||void 0===t?void 0:t.type)==="aiMessage"}),[f,v]),y=(0,l.C)(),_=(0,r.D)({mutationFn:async()=>{if(!t)throw Error("No projectId found");if(u){if(!("content"in u))throw Error("Invalid message type");g({...u,stopped:!0})}return s.post("/projects/".concat(t,"/chat/").concat(b,"/cancel"))},onMutate:()=>{let e=j&&v[j];if(e&&"aiMessage"===e.type){let t=e.content===c.u?"This message was cancelled.":e.content;x(j,{...e,content:t,status:"stopped",stopped:!0},!0)}},onSuccess:()=>{h(null==u?void 0:u.id),p(b),g(void 0)},onError:()=>{n.Am.error("Failed to stop message",{description:"Please try again"})}});return{showStopAction:b!==m&&y,mutation:_}}},36512:function(e,t,s){"use strict";s.d(t,{T:function(){return l},r:function(){return o}});var r=s(57437),a=s(2265),n=s(50273);let i=(0,a.createContext)({currentFile:null,states:{},openTabs:[],targetFileAndLineRange:null,setCurrentFile:()=>{},setStates:()=>{},setOpenTabs:()=>{},openFileAtLine:()=>{},openFileAtLineRange:()=>{},clearLineHighlight:()=>{}});function l(e){let{children:t}=e,[s,l]=(0,a.useState)(null),[o,d]=(0,a.useState)({}),[c,u]=(0,a.useState)([]),[m,p]=(0,a.useState)(null),h=(0,n.UC)(e=>e.selectedElements),g=(0,n.UC)(e=>e.isVisualEditingActive),x=(0,a.useCallback)((e,t)=>{let s=t||1;p({filePath:e,startLine:s,endLine:s}),u(t=>t.includes(e)?t:[...t,e]),l(e)},[]),f=(0,a.useCallback)((e,t,s)=>{p({filePath:e,startLine:t,endLine:s||t}),u(t=>t.includes(e)?t:[...t,e]),l(e)},[]),v=(0,a.useCallback)(()=>{p(null)},[]);(0,a.useEffect)(()=>{g||0!==h.length||v()},[g,h,v]);let b=(0,a.useMemo)(()=>({currentFile:s,setCurrentFile:l,states:o,setStates:d,openTabs:c,setOpenTabs:u,targetFileAndLineRange:m,openFileAtLine:x,openFileAtLineRange:f,clearLineHighlight:v}),[s,o,c,m,x,f,v]);return(0,r.jsx)(i.Provider,{value:b,children:t})}let o=()=>{let e=(0,a.useContext)(i);if(void 0===e)throw Error("useCodeEditor must be used within a CodeEditorProvider");return e}},91576:function(e,t,s){"use strict";s.d(t,{UL:function(){return p},hw:function(){return h},t6:function(){return x},v7:function(){return g}});var r,a=s(57437),n=s(52089),i=s(61062),l=s(72384),o=s(94508),d=s(78079),c=s(10867);(r||(r={})).AI_FIX="AI Fix";let{AI_FIX:u}=r;i.N.NO_CODE_CHANGE,i.N.CODE_DIFF,i.N.FILE_EDITED_WITHOUT_PERMISSION,i.N.EXCLUDED_FILE_EDITED,i.N.DEPENDENCY_INSTALL,i.N.IMMEDIATE_RUNTIME,i.N.RUNTIME,i.N.BUILD,i.N.HTTP_CLIENT_ERROR,i.N.HTTP_SERVER_ERROR,i.N.SUPABASE_EDGE_FUNCTION_ERROR,i.N.CORS_ERROR,i.N.DEPLOY_SUPABASE_FUNCTIONS,i.N.SUPABASE_SQL_ERROR,i.N.SEARCH_REPLACE_FAILED,i.N.SEARCH_REPLACE_MISSING_FILE,i.N.CHANGED_MISSING_FILE,i.N.RENAME_FAILED,i.N.DELETION_FAILED;let m=e=>{let t=(0,n.H$)(e),s=t.length>1?e=>"# Error number ".concat(e+1,":\n#################\n\n"):()=>"",r=t.map((e,t)=>"".concat(s(t)).concat(e.error_message,"\n").concat(e.meta_data?"\n"+JSON.stringify(e.meta_data,null,2):"")).join("\n\n").replace(/\x1B\[[0-9;]*[JKmsu]/g,"");return r.length>2e4?r.slice(0,2e4)+"... (truncated)":r},p=e=>{let{errors:t,roundedTop:s=!0}=e;return(0,a.jsx)("div",{className:s?"mt-4":"",children:(0,a.jsx)("pre",{className:(0,o.cn)("w-full rounded-xl border-[3px] border-warning bg-background p-3 text-sm text-foreground",s?"mt-2 rounded-t-md":""),children:(0,a.jsx)("code",{className:"block w-full overflow-x-auto overflow-y-auto whitespace-pre-wrap",children:m(t)})})})},h=e=>{let{projectId:t,errors:s}=e,{mutate:r,isPending:a}=(0,d.mo)({projectId:t});return{onClick:()=>{r({body:{id:(0,c.Fd)(),message:"For the code present, I get the error below.\n\nPlease think step-by-step in order to resolve it.\n```\n".concat(m(s),"\n```\n"),mode:l.S.INSTANT,contains_error:!0,error_ids:s.map(e=>e.id)},projectId:t})},isPending:a}},g={[i.N.BUILD]:"Build unsuccessful",[i.N.CODE_DIFF]:"Changes couldn't be applied",[i.N.DEPLOY_SUPABASE_FUNCTIONS]:"Couldn't deploy Supabase functions",[i.N.DEPENDENCY_INSTALL]:"Couldn't install dependency",[i.N.FILE_EDITED_WITHOUT_PERMISSION]:"Tried editing file without permission",[i.N.EXCLUDED_FILE_EDITED]:"Unwanted changes",[i.N.IMMEDIATE_RUNTIME]:"Oops, it looks like our AI had a bit of a hiccup and broke the app",[i.N.NO_CODE_CHANGE]:"Changes already applied",[i.N.RUNTIME]:"The app encountered an error",[i.N.HTTP_CLIENT_ERROR]:"The app encountered an error",[i.N.HTTP_SERVER_ERROR]:"The app encountered an error",[i.N.SUPABASE_EDGE_FUNCTION_ERROR]:"The app encountered an error",[i.N.CORS_ERROR]:"The app encountered an error",[i.N.SUPABASE_SQL_ERROR]:"An error occurred while applying the migration",[i.N.SEARCH_REPLACE_FAILED]:"Failed search-replace",[i.N.SEARCH_REPLACE_MISSING_FILE]:"Search-replace on missing file",[i.N.CHANGED_MISSING_FILE]:"Tried deleting or renaming non-existent file",[i.N.RENAME_FAILED]:"Failed to rename file",[i.N.DELETION_FAILED]:"Failed to delete file"},x={[i.N.BUILD]:!0,[i.N.CODE_DIFF]:!0,[i.N.SUPABASE_EDGE_FUNCTION_ERROR]:!0,[i.N.DEPENDENCY_INSTALL]:!0,[i.N.DEPLOY_SUPABASE_FUNCTIONS]:!0,[i.N.HTTP_CLIENT_ERROR]:!0,[i.N.HTTP_SERVER_ERROR]:!0,[i.N.CORS_ERROR]:!0,[i.N.FILE_EDITED_WITHOUT_PERMISSION]:!0,[i.N.EXCLUDED_FILE_EDITED]:!0,[i.N.IMMEDIATE_RUNTIME]:!0,[i.N.NO_CODE_CHANGE]:!0,[i.N.RUNTIME]:!0,[i.N.SUPABASE_SQL_ERROR]:!0,[i.N.SEARCH_REPLACE_FAILED]:!0,[i.N.SEARCH_REPLACE_MISSING_FILE]:!0,[i.N.CHANGED_MISSING_FILE]:!0,[i.N.RENAME_FAILED]:!0,[i.N.DELETION_FAILED]:!0}},86843:function(e,t,s){"use strict";s.d(t,{p:function(){return R}});var r=s(57437),a=s(2265),n=s(14438),i=s(85460),l=s(57346),o=s(74746),d=s(77113),c=s(87418),u=s(18252),m=s(50618),p=s(62869),h=s(36461),g=s(76906),x=s(94508),f=s(66491),v=s(67003),b=s(68640),j=s(50126);let y=(0,a.memo)(e=>{var t;let{messageId:s,edit:n,isRevertMessage:i,isUnderDaySection:c}=e,{commit_sha:u}=null!=n?n:{},{setActiveEditId:y}=(0,j.pE)(),_=(0,j.Sl)(e=>e.activeEditId),w=(0,o.aK)(e=>e.edits),N=_?w[_]:null,E=(0,d.iZ)(e=>e.project),{setActiveMessageId:C,setShowConsole:S,setConsolePreviewContent:k,exitConsole:I}=(0,j.pE)(),A=(0,j.Sl)(e=>e.consoleContentType),{toggleBookmark:P}=(0,h.g)((null==E?void 0:E.id)||""),M=(0,a.useMemo)(()=>{if(u&&E)return(0,g.t)({projectId:null==E?void 0:E.id,sha:u})},[u,E]),T=(0,b.Y)({editId:null==n?void 0:n.id,commitSha:null!==(t=null==n?void 0:n.commit_sha)&&void 0!==t?t:void 0}),D=n&&(null==N?void 0:N.id)===(null==n?void 0:n.id)&&"snapshot-preview"===A||T&&!N&&!A,R=(0,a.useMemo)(()=>{if(!(null==n?void 0:n.created_at))return null;let e=new Date(1e3*n.created_at.seconds);return c?{absolute:(0,f.WU)(e,"h:mm a"),relative:(0,f.WU)(e,"h:mm a")}:function(e){let t=!(0,v.X)(e),s="MMM d";return t&&(s+=", yyyy"),s+=", h:mm a",{absolute:(0,f.WU)(e,s),relative:(0,f.WU)(e,s)}}(e)},[n,c]),L=(0,a.useCallback)(e=>{var t;if(e.altKey){window.open(M,"_blank");return}if(D||T){I();return}S("snapshot-preview"),C(s),k(M),y(null!==(t=null==n?void 0:n.id)&&void 0!==t?t:void 0)},[n,I,D,T,s,M,y,C,k,S]),z=(0,a.useCallback)(e=>{e.stopPropagation(),(null==n?void 0:n.id)&&P(n.id,!!n.bookmarked)},[n,P]),{commit_message:O}=null!=n?n:{};return(0,r.jsxs)("div",{className:"flex h-11 min-w-0 items-center gap-1 md:h-10 md:px-3",children:[i?(0,r.jsx)(l.Z,{name:"restart_alt",className:"mb-px text-muted-foreground",size:"small"}):(0,r.jsx)(m.Z,{onClick:z,isBookmarked:!!n.bookmarked&&(null==n?void 0:n.bookmarked),className:(0,x.cn)(!n.bookmarked&&"md:opacity-0 md:group-hover:opacity-100")}),(0,r.jsx)(p.z,{onClick:L,disabled:!n,className:(0,x.cn)("group flex h-10 w-full cursor-pointer items-center gap-2 rounded-lg px-2.5 text-left text-base font-medium transition-colors duration-150 ease-in-out md:h-9 md:text-sm","min-w-0 bg-background text-foreground hover:bg-muted-hover",{"bg-affirmative text-affirmative-foreground hover:bg-affirmative/80":D&&!i}),children:(0,r.jsxs)("div",{className:"flex w-full min-w-0 items-center justify-between gap-2 overflow-hidden",children:[(0,r.jsx)("div",{className:"flex min-w-0 items-center gap-x-2 gap-y-1 font-normal",children:i?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"text-base text-muted-foreground md:text-sm",children:"Restored"}),(0,r.jsx)("div",{className:"min-w-0 gap-1 truncate rounded-sm border border-muted-border bg-background px-2 py-px",children:O})]}):(0,r.jsx)("span",{className:"items-center gap-1 truncate",children:O})}),(0,r.jsx)("span",{className:(0,x.cn)("text-sm font-normal text-muted-foreground md:text-xs",D&&!i&&"text-affirmative-foreground"),children:R&&(0,r.jsx)(r.Fragment,{children:R.absolute})})]})})]})});y.displayName="HistoryCardContent";let _=e=>{let{messageId:t,isUnderDaySection:s=!1}=e,a=(0,o.aK)(e=>e.messages[t]),n=(0,o.tV)((null==a?void 0:a.type)==="aiMessage"||(null==a?void 0:a.type)==="manualEdit"?null==a?void 0:a.editId:void 0),i=(0,o.uO)((null==a?void 0:a.type)==="userCommit"||(null==a?void 0:a.type)==="revertSuccess"?null==a?void 0:a.shortCommitHash:void 0);if(!a||!["aiMessage","manualEdit","userCommit","revertSuccess"].includes(a.type))return null;let l="userCommit"===a.type||"revertSuccess"===a.type?i:n;return l?(0,r.jsx)("div",{className:"group flex flex-col","data-message-id":a.id,"data-message-edit-id":(0,u.Y)(a),children:(0,r.jsx)(y,{messageId:a.id,edit:l,isRevertMessage:"revertSuccess"===a.type,isUnderDaySection:s})}):null};var w=s(56942),N=s(65696),E=s(70817),C=s(3442),S=s(95775);let k=e=>{let{message:t,edits:s,latestPublishedTimestamp:r}=e,a=s[t.editId];return r&&a?a.created_at.toDate()>r:!r&&!!a},I=e=>{let{message:t,latestPublishedTimestamp:s}=e;return s&&t.createdAt?t.createdAt>s:!s&&!!t.createdAt},A=e=>{let{message:t,edits:s,latestPublishedTimestamp:r}=e;return"revertSuccess"===t.type?k({message:t,edits:s,latestPublishedTimestamp:r}):I({message:t,latestPublishedTimestamp:r})},P=e=>{let{messageIds:t,messages:s}=e,r=new Map;return t.forEach(e=>{let t=s[e];if(!(null==t?void 0:t.createdAt))return;let a=(0,f.WU)(t.createdAt,"yyyy-MM-dd");r.has(a)||r.set(a,[]),r.get(a).push(e)}),r},M=e=>{let{messagesByDate:t}=e,s=(0,w.b)(new Date),r=(0,N.z)(s,{weekStartsOn:1}),a=e=>(0,E.z)(e)?"Today":(0,C.g)(e)?"Yesterday":(0,S._)(e,{start:r,end:s})?(0,f.WU)(e,"EEEE"):(0,f.WU)(e,"MMMM d");return Array.from(t.entries()).sort((e,t)=>{let[s]=e,[r]=t;return r.localeCompare(s)}).map(e=>{let[t,s]=e;return{label:a(new Date(t)),messageIds:s}})},T=e=>{let{messageIds:t,messages:s}=e;return M({messagesByDate:P({messageIds:t,messages:s})})},D=e=>{let{messageIds:t,getEditByShortCommitHash:s,latestPublishedTimestamp:r}=e,a=(0,o.aK)(e=>e.edits),n=(0,o.aK)(e=>e.messages),i=[],l=[],d=[],c=e=>["manualEdit","aiMessage","revertSuccess","userCommit"].includes(e),u=e=>{if("userCommit"===e.type||"revertSuccess"===e.type){let t=s(e.shortCommitHash);return!!(null==t?void 0:t.bookmarked)}if("editId"in e&&e.editId){let t=a[e.editId];return!!(null==t?void 0:t.bookmarked)}return!1};return t.forEach(e=>{let t=n[e];if(c(t.type)&&("manualEdit"!==t.type&&"aiMessage"!==t.type||t.editId)){if(u(t)&&"revertSuccess"!==t.type&&i.push(e),A({message:t,edits:a,latestPublishedTimestamp:r})){l.push(e);return}(null==t?void 0:t.createdAt)&&d.push(e)}}),{unpublishedMessageIds:l,bookmarkedMessageIds:i,groupedDailyMessageIds:T({messageIds:d,messages:n}),hasBookmarkedMessages:i.length>0,hasUnpublishedMessages:l.length>0,hasDailyMessages:d.length>0,splitMessageCount:i.length+l.length+d.length}},R=(0,a.memo)(()=>{var e,t;let s=(0,a.useRef)(null),u=(0,a.useRef)(null),m=(0,d.iZ)(e=>e.project),{snapshot:p,loadEarlierEdits:h}=(0,o.mx)(),g=(0,o.aK)(e=>{let t=e.messages;return Object.keys(t).sort((e,s)=>{var r,a,n,i;return((null===(a=t[e])||void 0===a?void 0:null===(r=a.createdAt)||void 0===r?void 0:r.getTime())||0)-((null===(i=t[s])||void 0===i?void 0:null===(n=i.createdAt)||void 0===n?void 0:n.getTime())||0)})}),x=(0,o.aK)(e=>e.edits),f=(0,o.aK)(e=>"loading"===e.loadingEditsStatus),v=(0,o.aK)(e=>e.hasOlderEdits),b=(0,o.aK)(e=>e.canLoadMoreEdits),j=(0,o.uO)(null!==(t=null==m?void 0:m.latest_commit_sha)&&void 0!==t?t:void 0),{isScrolledToEnd:y,checkScrollPosition:w}=(0,c.W)({listRef:u,containerRef:s}),N=(0,a.useMemo)(()=>[...g].reverse(),[g]);(0,a.useEffect)(()=>{y&&v&&b&&h().catch(()=>{n.Am.error("Failed to load earlier edits")})},[y,v,b,h]);let{unpublishedMessageIds:E,groupedDailyMessageIds:C,bookmarkedMessageIds:S,hasBookmarkedMessages:k,hasUnpublishedMessages:I,hasDailyMessages:A,splitMessageCount:P}=D({messageIds:N,latestPublishedTimestamp:(0,a.useMemo)(()=>{var e;let t=null==m?void 0:null===(e=m.published_deployment)||void 0===e?void 0:e.commit_sha;if(!t)return null;let s=Object.values(x).find(e=>e.commit_sha===t);return s?s.created_at.toDate():null},[null==m?void 0:null===(e=m.published_deployment)||void 0===e?void 0:e.commit_sha,x]),getEditByShortCommitHash:p.getEditByShortCommitHash}),M=(0,a.useRef)(void 0);return((0,a.useEffect)(()=>{if(u.current&&P>0&&void 0!==M.current&&M.current<P){let e=u.current.scrollOffset;u.current.scrollTo(e)}M.current=P},[P]),j&&(k||I||A))?(0,r.jsxs)("div",{ref:s,className:"flex min-h-0 flex-1 overflow-y-scroll",children:[(0,r.jsxs)(i.dM,{overscan:5,ref:u,onScroll:()=>{w()},children:[k&&(0,r.jsx)(L,{title:"Bookmarked",children:S.map(e=>(0,r.jsx)(_,{messageId:e},e))}),I&&(0,r.jsx)(L,{title:"Unpublished",children:E.map(e=>(0,r.jsx)(_,{messageId:e},e))}),A&&C.map(e=>{let{label:t,messageIds:s}=e;return(0,r.jsx)(L,{title:t,children:s.map(e=>(0,r.jsx)(_,{messageId:e,isUnderDaySection:!0},e))},t)})]}),f&&(0,r.jsx)("div",{className:"flex items-center justify-center gap-2 text-sm",children:(0,r.jsx)(l.Z,{className:"animate-spin",name:"progress_activity",size:"small"})})]}):null});R.displayName="HistoryPanel";let L=e=>{let{title:t,subtitle:s,children:a}=e;return(0,r.jsxs)("div",{className:"mb-4 mt-2 flex flex-col",children:[(0,r.jsxs)("p",{className:"mb-1 text-lg font-medium md:pl-3 md:text-base",children:[t,s&&(0,r.jsx)("span",{className:"ml-1 text-sm font-normal text-muted-foreground",children:s})]}),a]})}},63858:function(e,t,s){"use strict";s.d(t,{A:function(){return r},g:function(){return a}});let r={'pre[class*="language-"]':{color:"#c9d1d9",background:"var(--muted)",fontSize:"13px",fontFamily:'var(--font-roboto-mono), "Roboto Mono", Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace',lineHeight:"1.5",padding:"1em",overflow:"auto"},'code[class*="language-"]':{color:"#c9d1d9",fontSize:"13px",fontFamily:'var(--font-roboto-mono), "Roboto Mono", Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace',lineHeight:"1.5"},comment:{color:"#8b949e"},boolean:{color:"#ff7b72"},number:{color:"#79c0ff"},constant:{color:"#79c0ff"},operator:{color:"#7ee787"},keyword:{color:"oklch(0.833 0.145 321.434)"},function:{color:"#d2a8ff"},variable:{color:"#c9d1d9"},"class-name":{color:"#ffa657"},"type-name":{color:"#ffa657"},"attr-name":{color:"#79c0ff"},string:{color:"#a5d6ff"},tag:{color:"#7ee787"},punctuation:{color:"#7ee787"},selector:{color:"#7ee787"},namespace:{color:"#c9d1d9"},regex:{color:"#ff7b72"},escape:{color:"#a5d6ff"},"::selection":{background:"#2d333b"}},a={'pre[class*="language-"]':{color:"#24292e",background:"var(--background)",fontSize:"13px",fontFamily:'var(--font-roboto-mono), "Roboto Mono", Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace',lineHeight:"1.5",padding:"1em",overflow:"auto"},'code[class*="language-"]':{color:"#24292e",fontSize:"13px",fontFamily:'var(--font-roboto-mono), "Roboto Mono", Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace',lineHeight:"1.5"},comment:{color:"#6e7781"},boolean:{color:"#cf222e"},number:{color:"#0550ae"},constant:{color:"#0550ae"},operator:{color:"#116329"},keyword:{color:"#3479E5"},function:{color:"#8250df"},"class-name":{color:"#953800"},"attr-name":{color:"#0550ae"},string:{color:"#0a3069"},tag:{color:"#116329"},punctuation:{color:"#116329"},"::selection":{background:"#C7E4FF"}}},62809:function(e,t,s){"use strict";s.d(t,{C:function(){return n}});var r=s(69367),a=s(2265);function n(e){let[t,s]=(0,a.useState)(0),[n,i]=(0,a.useState)(0),[l,o]=(0,a.useState)(e);return(0,a.useLayoutEffect)(()=>{l!==e&&(o(e),i(t))},[e,l,t]),(0,a.useEffect)(()=>{let t=e.split("").length-n,a=(0,r.j)(n,e.split("").length,{duration:Math.max(.1,Math.min(5,t/140)),bounce:0,onUpdate(e){s(Math.floor(e))}});return()=>a.stop()},[n,e]),e.split("").slice(0,t).join("")}},6809:function(e,t,s){"use strict";s.d(t,{N:function(){return i}});var r=s(75403),a=s(72253),n=s(77113);function i(){var e,t;let s=(0,n.iZ)(e=>e.project),i=null==s?void 0:s.supabase_project_config,l=(0,a.S)({workspaceId:null!==(t=null==s?void 0:s.workspace_id)&&void 0!==t?t:""}),o=(0,r.Z)(l,i),d=null===(e=l.supabaseOrganizations)||void 0===e?void 0:e.flatMap(e=>e.projects||[]);return!o&&d&&(null==i?void 0:i.supabase_project_id)&&d.find(e=>e.id===i.supabase_project_id)||null}},3097:function(e,t,s){"use strict";s.d(t,{U:function(){return d},b:function(){return o}});var r=s(5978),a=s(2265),n=s(78099),i=s(74746);let l=e=>{if(e.created_at&&!(e.created_at instanceof r.EK)){let{seconds:t,nanoseconds:s}=e.created_at;return{...e,created_at:new r.EK(t,s)}}return e},o=()=>{let e=(0,i.aK)(e=>e.latestStreamedMessage);return e?l(e):null},d=e=>{let{projectId:t,messageId:s}=e,[i,l]=(0,a.useState)(null);return(0,a.useEffect)(()=>{if(!t||!s)return;let e=(0,r.JU)(n.db,"projects",t,"trajectory",s);return(0,r.cf)(e,e=>{e.exists()?l(e.data()):l(null)})},[t,s]),i}},79396:function(e,t,s){"use strict";s.d(t,{I:function(){return p}});var r=s(21770),a=s(14438),n=s(65666),i=s(49131),l=s(21288),o=s(50126),d=s(37675),c=s(5978),u=s(2265),m=s(78099);let p=e=>{let{setIsSomeRevertMutationPending:t}=(0,d.Xr)(),s=(0,i.SJ)(),p=(0,n.D)(),{setActiveEditId:h}=(0,o.pE)(),{isRevertSafe:g}=function(e){let{projectId:t}=e,s=(0,u.useCallback)(async e=>{let{targetEditId:s}=e,r=await (0,c.QT)((0,c.JU)(m.db,"projects",t,"edits",s));if(!r.exists())return l.logging.warn("invalid_edit_id_for_supabase_revert_check",{editId:s}),!0;let a=r.data();return(await (0,c.PL)((0,c.IO)((0,c.hJ)(m.db,"projects",t,"trajectory"),(0,c.ar)("created_at",">",a.created_at),(0,c.ar)("sql_run_state","in",["running","succeeded"]),(0,c.Xo)("created_at","desc"),(0,c.b9)(1)))).empty},[t]);return{isRevertSafe:(0,u.useCallback)(e=>{let{targetEditId:t}=e;return s({targetEditId:t})},[s])}}({projectId:p}),{setEditIdToConfirmRestoreFor:x}=(0,d.Xr)(),f=async t=>{let{edit:r,dry_run:a,via_undo:n}=t,i=r.id;if(r.revert_target_edit_id&&(i=r.revert_target_edit_id),!(null==e?void 0:e.skipSafetyCheck)&&!await g({targetEditId:i}))return null;let l={edit_id:i,dry_run:a,via_undo:n};return s.post("/projects/".concat(p,"/revert-to-edit"),l)};return(0,r.D)({mutationFn:f,onMutate:()=>{t(!0)},onSuccess:(t,s)=>{var r;if(!t){x(s.edit.revert_target_edit_id||s.edit.id);return}if(!s.via_undo){let e=t.commit_message;void 0===e&&t.tags&&(e=t.tags.summary);let s=e?"Restored to earlier version: ".concat(e):"Restored to earlier version";a.Am.success("Success",{description:s})}null==e||null===(r=e.onSuccess)||void 0===r||r.call(e),h(t.id)},onError:e=>{var t;l.logging.error("could_not_revert_to_earlier_version",{error:e}),a.Am.error("Could not revert to earlier version",{description:null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.detail})},onSettled:()=>{t(!1)}})}},72380:function(e,t,s){"use strict";s.d(t,{v:function(){return l}});var r=s(21770),a=s(60256),n=s(64040),i=s(49131);let l=()=>{let{userData:e}=(0,a.SE)();return(0,r.D)({mutationFn:async t=>(0,i.SJ)().put("/user/".concat(e.id),{tips:t}),onError:e=>{(0,n.Eo)(e)}})}},68640:function(e,t,s){"use strict";s.d(t,{Y:function(){return n}});var r=s(74746),a=s(77113);let n=e=>{var t;let s=(0,a.iZ)(e=>e.project),n=(0,r.uO)(null!==(t=null==s?void 0:s.latest_commit_sha)&&void 0!==t?t:void 0);return e.commitSha===(null==s?void 0:s.latest_commit_sha)||(null==n?void 0:n.type)=="revert"&&n.revert_target_edit_id==e.editId}},60254:function(e,t,s){"use strict";s.d(t,{A7:function(){return m},TO:function(){return c},ag:function(){return u}});var r=s(57437),a=s(2265),n=s(59625),i=s(14884);let l=e=>({files:{},pendingChanges:{},isLoading:!1,isSyncing:!1,lastSyncTimestamp:void 0,syncError:void 0,uploads:[],projectId:e,searchQuery:"",expandedSearchFiles:new Set,sidebarTab:"files"}),o=e=>(0,n.Ue)()((0,i.n)((t,s)=>({...l(e),setFile:(e,s)=>t(t=>({files:{...t.files,[e]:s}})),removeFile:e=>t(t=>{let{[e]:s,...r}=t.files;return{files:r}}),updateFileContent:(e,s)=>t(t=>({files:{...t.files,[e]:s}})),setSyncing:e=>t({isSyncing:e,lastSyncTimestamp:e?void 0:Date.now()}),setSyncError:e=>t({syncError:e,isSyncing:!1}),setLoading:e=>t({isLoading:e}),addPendingChange:(e,s)=>t(t=>({pendingChanges:{...t.pendingChanges,[e]:s}})),removePendingChange:e=>t(t=>{let{[e]:s,...r}=t.pendingChanges;return{pendingChanges:r}}),clearPendingChanges:()=>t({pendingChanges:{}}),hasUnsavedChanges:()=>{let{pendingChanges:e}=s();return Object.keys(e).length>0},reset:()=>t({...l(s().projectId)}),addUpload:e=>t(t=>({uploads:[...t.uploads,e]})),clearUploads:()=>t({uploads:[]}),setSearchQuery:e=>t({searchQuery:e}),setExpandedSearchFiles:e=>t({expandedSearchFiles:e}),setSidebarTab:e=>t({sidebarTab:e})}))),d=(0,a.createContext)(null),c=e=>{let{children:t,projectId:s}=e,n=(0,a.useRef)(o(s)),i=(0,a.useCallback)(()=>n.current.getState().pendingChanges,[]),l=(0,a.useCallback)(()=>n.current.getState().files,[]),c={store:n.current,snapshot:{getPendingChanges:i,getFiles:l}};return(0,r.jsx)(d.Provider,{value:c,children:t})};function u(){let e=(0,a.useContext)(d);if(!e)throw Error("useCodeEditorContext must be used within a CodeEditorProvider");return e}function m(e){let{store:t}=u();return t(e)}},25658:function(e,t,s){"use strict";s.d(t,{VF:function(){return d},f6:function(){return o},z:function(){return c}});var r=s(57437),a=s(2265),n=s(59625);let i=()=>(0,n.Ue)(()=>({showHistory:!1})),l=(0,a.createContext)(null),o=e=>{let{children:t}=e,s=(0,a.useRef)(i()),n={store:s.current,setShowHistory:e=>{let t=s.current,r=t.getState(),a="function"==typeof e?e(r.showHistory):e;t.setState({showHistory:a})}};return(0,r.jsx)(l.Provider,{value:n,children:t})};function d(){let e=(0,a.useContext)(l);if(!e)throw Error("useHistoryContext must be used within a HistoryProvider");return e}function c(e){let{store:t}=d();return t(e)}},63420:function(e,t,s){"use strict";s.d(t,{P:function(){return g},v:function(){return x}});var r=s(57437),a=s(46214),n=s(2265),i=s(64040),l=s(49131),o=s(32582),d=s(26034),c=s(21288),u=s(60254),m=s(29328),p=s(77113);let h=(0,n.createContext)(null);function g(e){let{children:t}=e,{refreshPreview:s,startLiveMode:g}=(0,m.My)(),x=(0,u.A7)(e=>e.setFile),f=(0,u.A7)(e=>e.pendingChanges),v=(0,u.A7)(e=>e.reset),b=(0,u.A7)(e=>e.clearPendingChanges),j=(0,u.A7)(e=>e.addPendingChange),y=(0,n.useRef)(null),_=(0,p.iZ)(e=>{var t;return null===(t=e.project)||void 0===t?void 0:t.id}),w=(0,u.A7)(e=>e.files),N=(0,n.useMemo)(()=>Object.entries(w),[w]),E=(0,u.A7)(e=>e.uploads),[C,S]=(0,n.useState)(!1),[k,I]=(0,n.useState)(null),[A,P]=(0,n.useState)([]),[M,T]=(0,n.useState)([]),{snapshot:D}=(0,u.ag)(),R=(0,n.useCallback)(()=>{N&&P((0,o.x2)(N))},[N]);(0,n.useEffect)(()=>{R()},[R]);let[L,z]=(0,n.useState)(!1),O=(0,n.useCallback)(()=>{z(!0),g()},[g,z]),F=(0,m.vE)();(0,n.useEffect)(()=>{if(!L||!F)return;let e=new URL("/_sandbox/code/ws",F);return y.current=new WebSocket(e),y.current.onmessage=e=>{try{let{type:t,data:s}=JSON.parse(e.data);if("init_code"===t)v(),S(!0),s.forEach(e=>{let[t,s]=e;x(t,s)});else if("file_update"===t){let e=D.getFiles();s.forEach(t=>{let[s,r]=t;e[s]!==r&&x(s,r)})}}catch(e){c.logging.error("Error processing WebSocket message",{project_id:_,error:e})}},y.current.onclose=e=>{e.wasClean||c.logging.error("Code WebSocket closed prematurely",{project_id:_,event:e})},y.current.onerror=e=>{c.logging.error("Code WebSocket error",{project_id:_,error:e})},()=>{var e;null===(e=y.current)||void 0===e||e.close(),y.current=null}},[F,_,v,x,L,D]);let Z=(0,n.useCallback)(async function(e){let{commitMessage:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a.ZP.capture("visual_edits:sync_started");let s=Object.entries(e);if(!_)throw Error("No project id");if(0===s.length)throw Error("No changes to sync");try{let e=(0,l.SJ)(),r=await Promise.all(E.map(e=>(0,d.Sv)({dir_name:e.dir_name,file_name:e.id}).then(t=>({download_url:t.url,file_id:e.file_name})))),a=await e.post("/projects/".concat(_,"/edit-code"),{changes:s.map(e=>{let[t,s]=e;return{path:t,content:s}}),uploads:r,commit_message:t||null});if("error"in a&&a.error)throw Error("Failed to sync code");b()}catch(e){(0,i.Eo)(e),a.ZP.capture("visual_edits:sync_failed",{error:e instanceof Error?e.message:"Unknown error",changes:null==s?void 0:s.map(e=>{let[t,s]=e;return[t,s.length]}),project_id:_})}},[_,E,b]),U=Object.keys(f).length>0;return(0,r.jsx)(h.Provider,{value:{syncCode:Z,ast:A,code:N,generateAst:R,refreshPreview:s,startLiveMode:O,history:M,setHistory:T,currentClassName:k,setCurrentClassName:I,addPendingChange:j,hasUnsavedChanges:U,hasInitialCode:C},children:t})}function x(){let e=(0,n.useContext)(h);if(!e)throw Error("useSandboxCode must be used within a SandboxCodeProvider");return{code:e.code,syncCode:e.syncCode,ast:e.ast,generateAst:e.generateAst,refreshPreview:e.refreshPreview,enableServer:e.startLiveMode,history:e.history,setHistory:e.setHistory,currentClassName:e.currentClassName,setCurrentClassName:e.setCurrentClassName,addPendingChange:e.addPendingChange,hasUnsavedChanges:e.hasUnsavedChanges,hasInitialCode:e.hasInitialCode}}},50273:function(e,t,s){"use strict";s.d(t,{NE:function(){return d},S9:function(){return c},UC:function(){return u}});var r=s(57437),a=s(2265),n=s(59625),i=s(14884);let l=()=>(0,n.Ue)()((0,i.n)(()=>({selectedElements:[],isVisualEditingActive:!1,isPickAndEditActive:!1,customPromptValue:"",isSaving:!1,floatingInputState:{isVisible:!1,position:null},visualEditsPanelState:{isOpen:!1,position:null},lastPanelPosition:null}))),o=(0,a.createContext)(null),d=e=>{let{children:t}=e,s=(0,a.useRef)(l()),n={store:s.current,setSelectedElements:e=>{s.current.setState(t=>{t.selectedElements=e})},removeSelectedElement:e=>{s.current.setState(t=>{t.selectedElements=t.selectedElements.filter(t=>t.filePath!==e.filePath||t.lineNumber!==e.lineNumber)})},turnOffVisualEditing:()=>{s.current.setState(e=>{e.isVisualEditingActive=!1,e.isPickAndEditActive=!1,e.selectedElements=[],e.isSaving=!1,e.visualEditsPanelState={isOpen:!1,position:null},e.floatingInputState={isVisible:!1,position:null}})},setIsVisualEditorPanelOpen:e=>{let t=s.current;"function"==typeof e?t.setState(t=>{t.isVisualEditingActive=e(t.isVisualEditingActive)}):t.setState(t=>{t.isVisualEditingActive=e})},setIsPickAndEditActive:e=>{let t=s.current;"function"==typeof e?t.setState(t=>{t.isPickAndEditActive=e(t.isPickAndEditActive)}):t.setState(t=>{t.isPickAndEditActive=e})},showFloatingInput:e=>{s.current.setState(t=>{t.floatingInputState={isVisible:!0,position:e}})},showVisualEditsPanel:e=>{s.current.setState(t=>{t.visualEditsPanelState={isOpen:!0,position:e},t.lastPanelPosition=e})},closeVisualEditsPanel:()=>{s.current.setState(e=>{e.visualEditsPanelState={isOpen:!1,position:null},e.customPromptValue="",e.selectedElements=[]})},hideVisualEditsPanel:()=>{s.current.setState(e=>{e.visualEditsPanelState.isOpen&&(e.lastPanelPosition=e.visualEditsPanelState.position),e.visualEditsPanelState={isOpen:!1,position:null}})},setCustomPromptValue:e=>{s.current.setState(t=>{t.customPromptValue=e})},setIsSaving:e=>{s.current.setState(t=>{t.isSaving=e})}};return(0,r.jsx)(o.Provider,{value:n,children:t})};function c(){let e=(0,a.useContext)(o);if(!e)throw Error("useVisualEditorContext must be used within a VisualEditorProvider");return e}function u(e){let{store:t}=c();return t(e)}},49968:function(e,t,s){"use strict";s.d(t,{Ny:function(){return d},U1:function(){return n},fA:function(){return i},oo:function(){return o},pr:function(){return l}});var r=s(54257);let a=()=>"https://console.firebase.google.com/u/0/project/".concat(r.q.projectId,"/firestore/databases/-default-/data"),n=e=>"".concat(a(),"/~2Fprojects~2F").concat(e),i=e=>e?"".concat(a(),"/~2Fusers~2F").concat(e):"",l=(e,t)=>"".concat(n(e),"~2Ftrajectory~2F").concat(t),o=(e,t)=>"".concat(n(e),"~2Fedits~2F").concat(t),d=e=>"".concat(a(),"/~2Fworkspaces~2F").concat(e)},23590:function(e,t,s){"use strict";s.d(t,{G:function(){return n}});var r=s(67817),a=s(2043);let n=()=>{let{canEdit:e,isWorkspaceMember:t}=(0,a.t)(),s=(0,r.v)();return t&&e||s}},27410:function(e,t,s){"use strict";var r=s(57437);s(2265);var a=s(81103);t.Z=e=>{let{children:t,label:s,side:n="bottom"}=e;return(0,r.jsxs)(a.u,{children:[(0,r.jsx)(a.aJ,{asChild:!0,children:t}),(0,r.jsx)(a._v,{className:"z-[2001]",side:n,children:s})]})}},74928:function(e,t,s){"use strict";s.d(t,{wy:function(){return n},zF:function(){return a}});var r=s(962);let a=r.fC,n=r.wy;r.Fw},35354:function(e,t,s){"use strict";var r=s(2265);t.Z=()=>{let[e,t]=(0,r.useState)("");return(0,r.useEffect)(()=>{t(a())},[]),{isMac:"mac"===e,isWindows:"windows"===e,isLinux:"linux"===e}};let a=()=>{let e=window.navigator.userAgentData,t=window.navigator.userAgent,s={iphone:/iphone/,ipad:/ipad|macintosh/,android:/android/},r={windows:/win/,mac:/macintosh/,linux:/linux/};if(t){let e=t.toLowerCase().replace(/^mozilla\/\d\.\d\W/,""),a=Object.keys(s).find(t=>s[t].test(e)&&window.navigator.maxTouchPoints>=1),n=Object.keys(r).find(t=>r[t].test(e));return a||n}return e?e.platform.toLowerCase():""}},52089:function(e,t,s){"use strict";s.d(t,{H$:function(){return g},hT:function(){return v},qV:function(){return x}});var r=s(21770),a=s(5978),n=s(2265),i=s(2208),l=s(29328),o=s(49131),d=s(78099),c=s(21288),u=s(61062),m=s(7163),p=s(98015);function h(e){var t,s,r;let a=e.meta_data?"|".concat(null===(t=e.meta_data)||void 0===t?void 0:t.colno,"|").concat(null===(s=e.meta_data)||void 0===s?void 0:s.lineno,"|").concat(null===(r=e.meta_data)||void 0===r?void 0:r.filename):"";return"".concat(e.error_message,"|").concat(e.type).concat(a)}function g(e){return e.filter((e,t,s)=>t===s.findIndex(t=>h(t)===h(e)))}function x(e){let{projectId:t,errorIds:s,setErrors:a}=e;return(0,r.D)({mutationFn:async()=>(a([]),(0,o.SJ)().patch("/projects/".concat(t,"/handle-errors"),{error_ids:s})),onError:e=>{c.logging.error("failed_to_submit_handled_errors",{error:e})}})}let f=e=>{e.sort((e,t)=>e.type===u.N.RUNTIME&&t.type!==u.N.RUNTIME?-1:t.created_at.seconds-e.created_at.seconds);let t={uniqueErrors:[],runtimeErrorMessages:new Set};return e.reduce((e,t)=>{if(t.type===u.N.IMMEDIATE_RUNTIME||t.type===u.N.RUNTIME){let s=t.error_message.replace(/\?v=[a-z0-9]{8}/,"?'");e.runtimeErrorMessages.has(s)||(e.runtimeErrorMessages.add(s),e.uniqueErrors.push(t))}else e.uniqueErrors.push(t);return e},t).uniqueErrors},v=e=>{let{projectId:t}=e,[s,r]=(0,n.useState)([]),u=(0,o.SJ)(),h=(0,l.vE)();(0,i.ZP)(h,{protocols:"vite-hmr",share:!0,onMessage:e=>{try{let r=JSON.parse(e.data);if((null==r?void 0:r.type)==="error"){var s;c.logging.info("build_error_from_devserver",{message:null==r?void 0:null===(s=r.err)||void 0===s?void 0:s.message});let e=m.p.safeParse(null==r?void 0:r.err);e.success?(0,p.e)(e.data,t,u):(c.logging.error("error_parsing_devserver_error",{error:e}),(0,p.e)(null==r?void 0:r.err,t,u))}}catch(e){c.logging.error("error_parsing_devserver_error",{error:e})}},onOpen:e=>{c.logging.debug("devserver_websocket_open")},onClose:e=>{c.logging.debug("devserver_websocket_close")},onError:e=>{c.logging.error("devserver_websocket_error",{event:e})},shouldReconnect:()=>!0,reconnectInterval:1e3});let g=x({projectId:t,errorIds:s.map(e=>e.id),setErrors:r});return(0,n.useEffect)(()=>{let e=function(e,t){let s=(0,a.hJ)(d.db,"projects/".concat(e,"/errors")),r=(0,a.IO)(s,(0,a.ar)("handled_at","==",null));return(0,a.cf)(r,e=>{e.empty?t([]):t(e.docs.map(e=>({...e.data(),id:e.id})))})}(t,r);return()=>e()},[t]),{errors:(0,n.useMemo)(()=>0===s.length?null:f(s),[s]),setErrors:r,handleErrorMutation:s.length>0?g:null}}},36461:function(e,t,s){"use strict";s.d(t,{g:function(){return p}});var r=s(21770),a=s(46214),n=s(2265),i=s(14438),l=s(74746),o=s(25658),d=s(85472),c=s(64040),u=s(49131),m=s(49284);let p=e=>{let{updateEdit:t}=(0,l.mx)(),{setShowHistory:s}=(0,o.VF)(),p=(0,r.D)({mutationFn:async t=>{let{editId:s,bookmarked:r,previousValue:a}=t;try{let t=(0,u.SJ)();return await t.put("/projects/".concat(e,"/bookmark/").concat(s),{bookmarked:r}),{editId:s,bookmarked:r}}catch(e){throw e}},onError:(e,s)=>{if(t(s.editId,{bookmarked:s.previousValue}),e instanceof d.H){let t=s.bookmarked?"bookmark":"unbookmark";i.Am.error("Failed to ".concat(t," edit"),{description:e.message||"Please try again"});return}(0,c.Eo)(e)},onSuccess:e=>{i.Am.success(e.bookmarked?"Bookmarked to history":"Bookmark removed from history",{action:{label:"View history",onClick:()=>s(!0)}})}});return{toggleBookmark:(0,n.useCallback)(function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=!s;a.ZP.capture(r?m.SL.BOOKMARK.ADDED:m.SL.BOOKMARK.REMOVED),t(e,{bookmarked:r}),p.mutate({editId:e,bookmarked:r,previousValue:s})},[p,t]),isToggling:p.isPending}}},32582:function(e,t,s){"use strict";s.d(t,{EE:function(){return h},H2:function(){return u},R5:function(){return o},Rw:function(){return l},Xu:function(){return c},cB:function(){return m},x2:function(){return i},xA:function(){return g}});var r=s(97569),a=s(76624),n=s(98891);function i(e){let t=[];return e.map(e=>{let s,[a,n]=e;if(a.endsWith(".tsx")||a.endsWith(".ts")||a.endsWith(".jsx")||a.endsWith(".js")){try{s=(0,r.parse)(n,{sourceFilename:a,sourceType:"module",plugins:["jsx","typescript"],allowImportExportEverywhere:!0})}catch(e){return}t.push({filePath:a,ast:s})}}),t}function l(e,t){let s=e.children.find(e=>n.isJSXText(e));s?s.value=t:e.children.unshift(n.jsxText(t))}function o(e,t){Object.keys(t).forEach(s=>{e.openingElement.attributes=e.openingElement.attributes.filter(e=>{var t;return n.isJSXAttribute(e)&&(null===(t=e.name)||void 0===t?void 0:t.name)!==s}),e.openingElement.attributes.push(n.jsxAttribute(n.jsxIdentifier(s),n.stringLiteral(t[s])))})}let d=e=>n.isStringLiteral(e)?e.value:null;function c(e){let t=e.openingElement.attributes.find(e=>n.isJSXAttribute(e)&&"className"===e.name.name);return void 0===t?"":(null==t?void 0:t.value)?d(t.value):null}let u=(e,t)=>{let s=t.find(t=>t.filePath===e.filePath);if(!s)return!1;let r=!1;return(0,a.default)(s.ast,{JSXElement(t){var s;if((null===(s=t.node.loc)||void 0===s?void 0:s.start.line)===e.lineNumber&&n.isJSXElement(t.node)){let e=t.node.children;r=1===e.length&&n.isJSXText(e[0]),t.stop()}}}),r},m=(e,t,s)=>{let r=t.find(t=>t.filePath===e.filePath);if(!r)return!1;let i=!1;return(0,a.default)(r.ast,{JSXElement(t){var r;(null===(r=t.node.loc)||void 0===r?void 0:r.start.line)===e.lineNumber&&n.isJSXElement(t.node)&&(i=t.node.openingElement.attributes.some(e=>{var t;return n.isJSXAttribute(e)&&n.isStringLiteral(e.value)&&(null===(t=e.name)||void 0===t?void 0:t.name)===s}),t.stop())}}),i},p=(e,t,s)=>{let r=s.find(e=>e.filePath===t);if(!r)return null;let n=null;return(0,a.default)(r.ast,{JSXElement(t){var s;(null===(s=t.node.loc)||void 0===s?void 0:s.start.line)===e&&(n=t.node,t.stop())}}),n},h=(e,t)=>{let s=p(e.lineNumber,e.filePath,t);return s?c(s):null},g=(e,t)=>{let s=t.find(t=>t.filePath===e.filePath);if(!s)return null;let r=null,n=null;return((0,a.default)(s.ast,{JSXElement(t){var s;(null===(s=t.node.loc)||void 0===s?void 0:s.start.line)===e.lineNumber&&(r=t.node.loc.start.line,n=t.node.loc.end.line,t.stop())}}),null===r||null===n)?null:{startLine:r,endLine:n}}},5635:function(e,t,s){"use strict";s.d(t,{B:function(){return i},a:function(){return a}});let r={text:"format_size",img:"image",button:"crop_16_9",link:"link",div:"select"},a=e=>r[n(e)],n=e=>["p","span","h1","h2","h3","h4","h5","h6"].includes(e)?"text":"img"===e?"img":"button"===e?"button":"a"===e?"link":"div",i=e=>n(e.elementType)},55214:function(e){e.exports={cursor:"PromptBox_cursor__MuO9l",blink:"PromptBox_blink__F53p4",customProse:"PromptBox_customProse__C94Rw"}}}]);